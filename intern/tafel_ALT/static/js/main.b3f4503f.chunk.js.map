{"version":3,"sources":["components/Defaults.js","components/functions.js","components/Platz.js","components/DayPicker.js","components/Belegungstag.js","components/BelForm.js","components/BelFormTrBuchung.js","components/Belegung.js","components/Routing.js","components/App.js","index.js"],"names":["config","testuser","id","vorname","nachname","permissions","stringSeparator","smartphoneWidth","anzahlPlaetze","platzArray","daypickerMaxDays","daypickerDaysBeforeToday","daypickerDaysBeforeTodayWide","buchungenlog","platzbuchungen","dailyStartTime","dailyEndTime","eveningTime","maxMinutesDistance","singleTime","doubleTime","turnierTime","gastId","mitgliedId","gastJugId","mitgliedJugId","platzLeer","platzBelegt","slotMinimalMinutes","delimiter","hostname","protokoll","loginPage","prod","std24","IMPORTANT","MSG","messages","gast","mitglied","veranstaltung","spieleranzahl","jugendvorrecht","erwachsenenvorrecht","einzeldauer","doppeldauer","turnier","turnierspieldauer","zeit","platzbelegt","max24h","i","push","formatDate","d","month","getMonth","day","getDate","year","getFullYear","length","join","spielerzusatz","geburtsdatum","schnupper","aktuellesJahr","Date","geburtsjahr","zusatz","Number","replace","jugendlicher","servertimeNow","servertime","parseCookie","document","cookie","str","split","map","v","reduce","acc","decodeURIComponent","trim","getTimetable","belegungen","endeTag","setHours","timetable","getTime","Config","tagesZeit","toTimeString","substr","bKey","sa","starts_at","anzahlSlots","ends_at","saTmp","cTmp","court","Platz","props","handleWindowSizeChange","setState","zumBelegungstag","state","courtData","isLoading","error","width","window","innerWidth","prevProps","this","fetchPlatz","uPermissions","userIsAllowed","url","addEventListener","fetch","credentials","then","result","ok","redirected","location","href","json","records","r","spieler","k","cn","computeBelClasses","booking_type","formatSpieler","platzWide","match","key","className","substring","comment","Link","to","pathname","c","op","removeEventListener","Component","p1vn","p1nn","p1geb","schnupper1","p2vn","p2nn","p2geb","schnupper2","p3vn","p3nn","p3geb","schnupper3","p4vn","p4nn","p4geb","schnupper4","s","RegExp","e","bookingType","dauer","bt","classNames","list","MenuItem","text","selected","Arrow","ArrowLeft","ArrowRight","DayPicker","onSelect","onClickHandler","startswith","end","setDate","start","dt","arr","name","toLocaleDateString","weekday","getDateArray","menu","el","data","arrowLeft","arrowRight","Belegungstag","dayDate","params","isNaN","setDay","bind","dString","firstDaypickerDay","courtDiv","src","alt","Zeitleiste","m","toString","padStart","index","Fragment","Legende","BelForm","handleChange","handleSave","handleDelete","sd","st","scd","ssd","timeDiff","valueOf","console","debug","canBookForTomorrow","deleteActive","user_id","p1id","p2id","p3id","p4id","includes","userId","Permissions","ed","et","sdA","spieltag","startsAtDate","endsAtDate","startsAt","endsAt","seriesId","series_id","p1","p2","p3","p4","belegungenAbJetzt","zurTafel","saveActive","endeActive","admin","overbooked","jugend","nichtVollBerechtigte","isLoading1","isLoading2","courtBelegt","Error","catch","Redirect","condMF","condTrainer","onChange","value","disabled","startsAtMsgClass","startsAtMsgTxt","Object","keys","ttl","p1MsgClass","p1MsgTxt","p1MsgFormCtrl","commentMsgClass","commentMsgTxt","type","placeholder","onClick","preventDefault","parameters","rc","returncode","logurl","Messages","sdStr","jetzt","target","endsAtViertel","endsAtStd","toLocaleString","minimumIntegerDigits","useGrouping","condEinGast","condEinMitglied","condEinSpielerErwVoll","condDoppelteSpieler","condUserIstSpieler","datestring","hd","Holidays","init","condSonnOderFeiertag","isHoliday","getDay","ende","pKeys","forEach","p","pAttr","find","o","isJugendlicher","saveActiveMerker","p1msgClass","_","uniq","dToday","getHours","getMinutes","BelFormTrBuchung","userDarfLoeschen","trainer","sp","Belegung","belegung","updateBel","newBel","getEmptyBel","Routing","Switch","Route","exact","path","render","App","user","isLoggedIn","renderData","checkUser","setPermission","res","retcode","ReactDOM","getElementById"],"mappings":"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","file":"static/js/main.b3f4503f.chunk.js","sourcesContent":["\r\n// ****** Konfigurationsdaten *******\r\n\r\nexport const hostLocal = false   // true = localhost zum Testen\r\n\r\nconst config = {\r\n  // testuser: {id:211, vorname:'Hart', nachname:'VerdrahtetAdm', permissions: 65535}, // mit Adminrechten\r\n  testuser: {id:211, vorname:'Hart', nachname:'VerdrahtetUsr', permissions: 0}, // mit normalen Benutzerrechten\r\n  //  testuser: {id:357, vorname:'Hart', nachname:'VerdrahtetUsr2', permissions: 432}, // mit normalen Benutzerrechten\r\n  stringSeparator: ' ',\r\n  smartphoneWidth: 578,\r\n  anzahlPlaetze: 6,\r\n  platzArray: [],\r\n  daypickerMaxDays: 180,\r\n  daypickerDaysBeforeToday: 3, \r\n  daypickerDaysBeforeTodayWide: 9, \r\n  buchungenlog: '/intern/api/buchungenlog.php',\r\n  platzbuchungen: '/intern/api/platz.php',\r\n\r\n  dailyStartTime: 8,\r\n  dailyEndTime: 20,\r\n  eveningTime: 1700,  // 17:00 Uhr, alte Platzordnung war 18:00 Uhr\r\n  maxMinutesDistance: 15, // Gäste und Jugendliche dürfen abends erst kurz vor der Spielzeit buchen\r\n  singleTime: 60, // = 1 Stunde\r\n  doubleTime: 120, // = 2 Stunden \r\n  turnierTime: 120, // = 2 Stunden \r\n  gastId: 1,\r\n  mitgliedId: 25,\r\n  gastJugId: 28,\r\n  mitgliedJugId: 29,\r\n  platzLeer: \"\\u00A0\\u00A0\",\r\n  platzBelegt: \"\\u29EB\",\r\n  slotMinimalMinutes: 1800000, // = 30 Minuten\r\n  delimiter: \"§§§\",\r\n  hostname: '',\r\n  protokoll: '',\r\n  loginPage: '',\r\n  prod: false,\r\n  std24: 93600000 // 24 Stunden + 1 Std Zeitzone + 1 Std Sommerzeit in Millisekunden \r\n  // std24: 50400000    // 12 Stunden + 1 Std Sommerzeit Zeitzone + 1 Std in Millisekunden\r\n}\r\nif (hostLocal) {\r\n  config.hostname = 'localhost'\r\n  config.protokoll = 'http://'\r\n  config.loginPage = '/intern/login.php'\r\n  config.prod = false\r\n} else {    \r\n  config.hostname = 'www.tcolching.de'\r\n  config.protokoll = 'https://'\r\n  config.loginPage = '/intern/login.php'\r\n  config.prod = true\r\n}\r\n\r\nconst IMPORTANT = \"text-danger\"\r\nconst MSG = \"text-info\"\r\nconst NOSAVE = false\r\nconst SAVE = true\r\n\r\nexport const messages = {\r\n  gast: [IMPORTANT, NOSAVE, '- Bitte den Gastnamen ins Kommentarfeld schreiben und die Gebühr innerhalb einer Woche überweisen!'],\r\n  mitglied: [IMPORTANT, NOSAVE, '- Bitte nur für Mitglieder ohne Email verwenden und den Namen ins Kommentarfeld schreiben!'],\r\n  veranstaltung: [MSG, SAVE, '- Bitte den Veranstaltungsanlass ins Kommentarfeld schreiben und den Vorstand informieren!'],\r\n  spieleranzahl: [IMPORTANT, NOSAVE, '- Bitte alle Personen eintragen!'],\r\n  jugendvorrecht: [MSG, SAVE, '- Achtung: Jugendliche haben auf Platz 6 zu dieser Zeit Vorrecht!'],\r\n  erwachsenenvorrecht: [IMPORTANT, NOSAVE, '- Buchung erst 15 Minuten vor Spielbeginn möglich, da werktags ab 17:00 Uhr ein erw. Vollmitglied mitspielen muss.'],\r\n  einzeldauer: [IMPORTANT, NOSAVE, '- Für ein Einzel maximal 60 Minuten buchen'],\r\n  doppeldauer: [IMPORTANT, NOSAVE, '- Für ein Doppel maximal 120 Minuten buchen'],\r\n  turnier: [MSG, SAVE, '- Turnierspiele 120 Minuten. Falls möglich auf Platz 1 buchen. Parallel sollte ein Platz auf der Anlage nicht durch Turniere oder Training belegt sein! Wer Mannschaftstraining hat, darf nur auf den Plätzen der Mannschaft Turnier spielen.'],\r\n  turnierspieldauer: [IMPORTANT, NOSAVE, '- Turnierspiele 120 Minuten. Falls möglich auf Platz 1 buchen. Parallel sollte ein Platz auf der Anlage nicht durch Turniere oder Training belegt sein! Wer Mannschaftstraining hat, darf nur auf den Plätzen der Mannschaft Turnier spielen.'],\r\n  zeit: [IMPORTANT, NOSAVE, '- Der Start muss vor dem Ende liegen!'],\r\n  platzbelegt:  [IMPORTANT, NOSAVE, '- Platz bereits belegt!'],\r\n  max24h:  [IMPORTANT, NOSAVE, '- Einzel/Doppel maximal 24 Stunden im Voraus buchbar!'],\r\n};\r\nfor (let i = 1; i <= config.anzahlPlaetze; i++) {\r\n  config.platzArray.push(i);\r\n}\r\n\r\n// ******* Rechtevergabe **********\r\nexport const permissions = {\r\n  // Es gibt 16 Rechte. Übereinandergelegt\r\n  \r\n  // Recht:        1 2 3 4  5  6  7   8   9  10   11   12   13   14    15    16\r\n  // Dezimalwert:  1 2 4 8 16 32 64 128 256 512 1024 2048 4096 8192 16384 32768 \r\n  //\r\n  // Summen daraus sind kombinierte Rechte, z.B. \r\n  //                3 ist Recht 1 und Recht 2\r\n  //               15 ist Recht 1, 2, 3, 4 (1+2+4+8)\r\n  //              128 ist Recht 8\r\n  //              143 ist Recht 1,2,3,4,8\r\n    NONE : 0,\r\n    MANNSCHAFTSFUEHRER : 32,\r\n    WIRT : 64,\r\n    T_ALL_PERMISSIONS : 128,    // Turnierverantwortliche\r\n    TRAINER : 256,\r\n    VORSTAND : 496,             // kombiniert 16, 32, 64, 128, 256\r\n    ADMINISTRATOR : 65535,\r\n};\r\n\r\nexport default config;\r\n","import Config from './Defaults';\r\n\r\nexport const formatDate = (d) => {\r\n  var month = '' + (d.getMonth() + 1),\r\n    day = '' + d.getDate(),\r\n    year = d.getFullYear();\r\n\r\n  if (month.length < 2) month = '0' + month;\r\n  if (day.length < 2) day = '0' + day;\r\n\r\n  return [year, month, day].join('-');\r\n}\r\n\r\n// ***** date array \r\nexport const getDateArray = (start, end) => {\r\n  let dt = new Date(start),\r\n    arr = [];\r\n  while (dt <= end) {\r\n    arr.push({ name: formatDate(dt), text: dt.toLocaleDateString(\"de-DE\", { weekday: 'short', month: 'short', day: 'numeric' }) });\r\n    dt.setDate(dt.getDate() + 1);\r\n  }\r\n  return arr;\r\n}\r\n\r\nexport const isValidDate = (d) => {\r\n  return d instanceof Date && !isNaN(d);\r\n}\r\n\r\nexport const spielerzusatz = (geburtsdatum, schnupper) => {\r\n  let aktuellesJahr = new Date();\r\n  aktuellesJahr = aktuellesJahr.getFullYear();\r\n  let geburtsjahr = new Date(geburtsdatum);\r\n  geburtsjahr = geburtsjahr.getFullYear();\r\n  const jugend = (aktuellesJahr - geburtsjahr) < 18 ? true : false;\r\n  // console.log(`${geburtsdatum} ${geburtsjahr} ${aktuellesJahr} ${jugend}` );\r\n  let zusatz = ' (' + (jugend ? 'Jug' : '') + (Number(schnupper) === 1 ? ',Schn' : '') + ')'\r\n  zusatz = zusatz.replace('(,', '(')\r\n  zusatz = zusatz.replace('()', '')\r\n  return zusatz\r\n}\r\n\r\n// jugendlicher = nicht voll Berechtigt\r\nexport const jugendlicher = (geburtsdatum) => {\r\n  if (typeof (geburtsdatum) === 'undefined' || geburtsdatum === null) {\r\n    return false;\r\n  }\r\n  let aktuellesJahr = new Date();\r\n  aktuellesJahr = aktuellesJahr.getFullYear();\r\n  let geburtsjahr = new Date(geburtsdatum);\r\n  geburtsjahr = geburtsjahr.getFullYear();\r\n  const jugend = ((aktuellesJahr - geburtsjahr) < 18) ? true : false;\r\n  // console.log(`${geburtsdatum} ${geburtsjahr} ${aktuellesJahr} ${jugend}` );\r\n  return jugend;\r\n}\r\n\r\n// Serverzeit?\r\nexport const servertimeNow = () => {\r\n  const cookies = parseCookie(document.cookie)\r\n  const servertime = cookies['servertime']\r\n  const st = new Date(Number(servertime))\r\n  return st\r\n}\r\n\r\n//#Source https://bit.ly/2neWfJ2 \r\nconst parseCookie = str =>\r\n  str\r\n    .split(';')\r\n    .map(v => v.split('='))\r\n    .reduce((acc, v) => {\r\n      acc[decodeURIComponent(v[0].trim())] = decodeURIComponent(v[1].trim());\r\n      return acc;\r\n    }, {});\r\n\r\n\r\n// Setze alle Zeiten auf false, die nicht als Start verwendet werden dürfen\r\nexport function getBookableTimes(tt) {\r\n  // Zu welchem Slot kann auf einem Platz gestartet werden?\r\n  let startBooking = ['--', '--', '--', '--', '--', '--']\r\n  for (let slot in tt) {  // Iteration über die Indizes der Slots\r\n    for (let p in tt[slot]) { // Iteration über die Indizes (0 - 5) der Plätze je Viertelstunden\r\n      if (startBooking[p] === '--' && tt[slot][p] === Config.platzBelegt) {  // Wenn ein Platz an einer Stelle nicht buchbar ist, ist er \"..\"\r\n        startBooking[p] = slot.substr(19, 2) // Merke dir die Minuten des Slots. An Pos 19 sind die Minuten\r\n      }\r\n    }\r\n  }\r\n  // Alle Plätze nur zu möglichen Startzeiten erlauben, andere Zeiten sperren (\"--\")\r\n  // z. B. Wenn eine Buchung um xx:30 Uhr besteht, dann sind keine Buchungen zur vollen Stunde erlaubt, \r\n  // um nicht Lücken entstehen zu lassen\r\n  // *****************  DERZEIT INAKTIV!!! ******************\r\n  const timetable = []\r\n  for (let slot in tt) {  // Iteration über die Indizes der Viertelstunden (0..51)\r\n    timetable[slot] = []\r\n    for (let p in tt[slot]) { // Iteration über die Indizes (0 - 5) der Plätze je Viertelstunden\r\n      // console.log(\"p, tt[slot][p]: \", p, tt[slot][p])\r\n      if (startBooking[p] === '--') { // Auf diesem Platz p gibt es an diesem Tag noch keine Buchung\r\n        timetable[slot][p] = tt[slot][p]  // Platzziffer übernehmen\r\n      }\r\n      else {\r\n        if ((startBooking[p] === slot.substr(19, 2) || tt[slot][p] === Config.platzBelegt)) {  // Das ist eine gültige Zeit für einen Platz\r\n          timetable[slot][p] = tt[slot][p] // Platzziffer (oder eben Sperrzeichen) übernehmen\r\n        } else {\r\n          timetable[slot][p] = Config.platzLeer\r\n        }\r\n      }\r\n    }\r\n  }\r\n  return timetable\r\n}\r\n\r\n// Liefere die Daten für einen HTML-SELECT mit belegten und freien Zeiten\r\nexport function getTimetable(belegungen) {\r\n  // Erzeuge alle Zeiten als Timestamps für den HTML-Select in einem zweidimensionalen Objekt\r\n  // mit Uhrzeiten im Slot-Takt (z. B. 30 oder 15 Minutene, je nach Config)\r\n  // in der Form {<uhrzeit> : {platz: <platz>, <aktiv|inaktiv>}}\r\n\r\n  let zeit = new Date();\r\n  let endeTag = new Date();\r\n\r\n  // Die Timetable erzeugen, alle Plätze und Zeiten \"frei\", also Anzeige der Platznummer\r\n  zeit.setHours(8, 0, 0, 0);\r\n  endeTag.setHours(21, 0, 0, 0);\r\n  const timetable = [];\r\n  for (; zeit <= endeTag; zeit = new Date(zeit.getTime() + Config.slotMinimalMinutes)) {\r\n    const tagesZeit = zeit.toTimeString().substr(0, 5)\r\n    timetable[tagesZeit] = [];\r\n    for (let i = 1; i <= Config.anzahlPlaetze; i++) {\r\n      timetable[tagesZeit].push(i);\r\n    }\r\n  }\r\n\r\n  // Jetzt belegte Zeiten mit \"X\" belegen\r\n  // Wir haben 2 Objekte: \r\n  // 1. Wir iterieren über die Belegungen, sortiert nach Anfangszeit und Platz. \r\n  // 2. timetable, auf das wir direkt über die Zeit zugreifen\r\n  // console.log(belegungen)\r\n  for (let bKey in belegungen) {\r\n    let sa = new Date(belegungen[bKey].starts_at);\r\n    let ea = new Date(belegungen[bKey].ends_at);\r\n    // console.log(belegungen[bKey].starts_at + \", \" + belegungen[bKey].ends_at)\r\n    let anzahlSlots = (ea - sa) / Config.slotMinimalMinutes;\r\n    for (let i = 0; i < anzahlSlots; i++) {\r\n      let saTmp = new Date(sa.getTime() + (i * Config.slotMinimalMinutes));\r\n      let cTmp = Number(belegungen[bKey].court) - 1;\r\n      timetable[saTmp.toTimeString().substr(0, 5)][cTmp] = Config.platzBelegt;\r\n      // console.log(saTmp, timetable[saTmp][cTmp], ', court: ', cTmp)\r\n    }\r\n  }\r\n  return timetable;\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n///////////////////////// KANN DAS FUNKTIONIEREN??? //////////////////////\r\n// const Model = () => {\r\n//   let liste = {};\r\n//   registerListener(callback) {\r\n//     liste                               ;\r\n//   }\r\n//   unregisterListener(callback) {\r\n//     callback.setTafelDatum(this.tafelDatum)///////////////////////////////////\r\n//   }\r\n// }\r\n\r\n// Auswahl über Mausposition???\r\n// handleClick (e) {\r\n\r\n//   var offset = $(this).offset();\r\n//   var hoehe = $(this).height(); \r\n//   var relativeX = (e.pageX - offset.left);\r\n//   var relativeY = (e.pageY - offset.top);\r\n//   var halbeStdHoehe = (hoehe - 30)/13;     \r\n//   var std = relativeY/halbeStdHoehe;\r\n//   var minuten = Math.round((std - Math.floor(std))) * 30;\r\n//   std = Math.floor(std) + 7;\r\n\r\n//   alert(\"X: \" + relativeX + \"  Y: \" + relativeY + \" Zeit: \" + std + \":\" + minuten + \" h, Höhe: \" + hoehe);\r\n\r\n// };\r\n","import React, { Component } from 'react';\r\nimport classNames from 'classnames';\r\nimport { Link } from 'react-router-dom';\r\nimport { spielerzusatz } from './functions';\r\nimport Config, { permissions } from './Defaults';\r\n\r\n\r\n// Alle Belegungen an diesem Tag für einen Platz\r\n\r\nclass Platz extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    \r\n    this.state = { \r\n      courtData: [],\r\n      isLoading : false,\r\n      error : false,\r\n      width: window.innerWidth,\r\n      zumBelegungstag: false,\r\n    };\r\n  }\r\n  \r\n  componentDidUpdate(prevProps) {\r\n    if (this.props.day !== prevProps.day) {\r\n      const {court, day, permissions} = this.props;\r\n      this.fetchPlatz(court, day, permissions);\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    const { court, day, permissions } = this.props;\r\n    this.fetchPlatz(court, day, permissions);\r\n  }\r\n  \r\n  fetchPlatz(court, day, uPermissions) {\r\n    const userIsAllowed = ((permissions.MANNSCHAFTSFUEHRER & uPermissions) > 0);\r\n    const url = Config.protokoll + Config.hostname + \"/intern/api/platz.php?op=ra&p=\" + court + \"&ds=\" + day + \"&de=\" + day;\r\n    window.addEventListener('resize', this.handleWindowSizeChange);\r\n    \r\n    this.setState({isLoading : true});\r\n    fetch(url, {credentials: 'same-origin'})\r\n    .then(result => {\r\n      if (result.ok) {\r\n        if (result.redirected) {\r\n          // console.log(\"Platz.js/Checkuser: Authentifizierungsfehler\")\r\n          window.location.href = result.url\r\n        }\r\n        return result.json();\r\n        } else {\r\n          // In diesem Fall haben wir einen neuen, noch unbebuchten Tag\r\n          this.setState({isLoading : false});\r\n        }\r\n      })\r\n    .then (result => {\r\n      let courtData = result.records.map ( r => {\r\n        let k = r.id\r\n        let spieler\r\n        let cn = computeBelClasses (r.starts_at, r.ends_at, r.booking_type);\r\n        spieler = formatSpieler(r, this.props.platzWide)\r\n\r\n        if ( !userIsAllowed && (r.booking_type.match(/(ts-training)|(ts-punktspiele)|(ts-nichtreservierbar)|(ts-veranstaltung)/ig)))\r\n        {\r\n          return ( \r\n            <div key={k} className={cn}>\r\n              <strong>{r.starts_at.substring(11,16)}</strong> {spieler} \r\n              <div> {r.comment} </div>\r\n            </div>\r\n          )\r\n        } else {\r\n          return ( \r\n            <Link key={k} className={cn} to={{ pathname: '/intern/tafel/belegung', state: {c: court, i: r.id, d: day, op: 'update'} }}>\r\n              <strong>{r.starts_at.substring(11,16)}</strong> {spieler}\r\n              <div> {r.comment} </div>\r\n            </Link>\r\n          )\r\n        }\r\n      })\r\n      this.setState({courtData: courtData});\r\n      this.setState({isLoading : false});\r\n    })\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    window.removeEventListener('resize', this.handleWindowSizeChange);\r\n  }\r\n\r\n  handleWindowSizeChange = () => {\r\n    // this.setState({ width: window.innerWidth });\r\n    this.setState({ zumBelegungstag: true });\r\n  };\r\n  \r\n  render() {\r\n    return this.state.courtData;\r\n  }\r\n}\r\n\r\n// Spielernamen bilden\r\nconst formatSpieler = (r, platzWide) =>\r\n{\r\n  let spieler = []\r\n  \r\n  // Vorname und Name verketten. Vorname bei wenig Platz abkürzen\r\n  // spieler[0] = (r.p1vn ? (platzWide ? r.p1vn : r.p1vn.charAt(0) + '.') + ' ' + r.p1nn : (r.p1nn) ? r.p1nn : '') + spielerzusatz(r.p1geb, r.schnupper1)\r\n  // spieler[1] = (r.p2vn ? (platzWide ? r.p2vn : r.p2vn.charAt(0) + '.') + ' ' + r.p2nn : (r.p2nn) ? r.p2nn : '') + spielerzusatz(r.p2geb, r.schnupper2)\r\n  // spieler[2] = (r.p3vn ? (platzWide ? r.p3vn : r.p3vn.charAt(0) + '.') + ' ' + r.p3nn : (r.p3nn) ? r.p3nn : '') + spielerzusatz(r.p3geb, r.schnupper3)\r\n  // spieler[3] = (r.p4vn ? (platzWide ? r.p4vn : r.p4vn.charAt(0) + '.') + ' ' + r.p4nn : (r.p4nn) ? r.p4nn : '') + spielerzusatz(r.p4geb, r.schnupper4)\r\n  \r\n  // Vorname und Name verketten. Vorname bei wenig Platz abkürzen\r\n  \r\n  spieler[0] = (r.p1vn ? r.p1vn + ' ' + r.p1nn : (r.p1nn) ? r.p1nn : '') + spielerzusatz(r.p1geb, r.schnupper1)\r\n  spieler[1] = (r.p2vn ? r.p2vn + ' ' + r.p2nn : (r.p2nn) ? r.p2nn : '') + spielerzusatz(r.p2geb, r.schnupper2)\r\n  spieler[2] = (r.p3vn ? r.p3vn + ' ' + r.p3nn : (r.p3nn) ? r.p3nn : '') + spielerzusatz(r.p3geb, r.schnupper3)\r\n  spieler[3] = (r.p4vn ? r.p4vn + ' ' + r.p4nn : (r.p4nn) ? r.p4nn : '') + spielerzusatz(r.p4geb, r.schnupper4)\r\n\r\n  // Führende Punkt und Whitespace entfernen, falls es sowas gibt\r\n  // eslint-disable-next-line\r\n  spieler = spieler.map( s => s.replace(new RegExp(/^[\\.\\s]+/g), '') )\r\n  // ... und trailing Kommas, Whitespaces entfernen\r\n  spieler = spieler.replace(new RegExp(/[,\\s]*$/g), '')\r\n\r\n  spieler = spieler.join(', ')\r\n\r\n  // Nochmal trailing Kommas, Whitespaces entfernen\r\n  spieler = spieler.replace(new RegExp(/[,\\s]*$/g), '')\r\n\r\n  return spieler\r\n\r\n}\r\n\r\n// CSS-Klassen bilden für die Positionierung und Höhe einer Belegung auf der Tafel\r\nconst computeBelClasses = (s, e, bookingType) =>\r\n{\r\n  // Dauer berechnen, also z. B. '2019-05-02 16:00:00' - '2019-05-02 14:00:00' = 120\r\n  const dauer = (Number(e.substring(11,13))*60 + Number(e.substring(14,16))) - (Number(s.substring(11,13))*60 + Number(s.substring(14,16)));\r\n  const bt = bookingType\r\n  let cn = classNames(\r\n    'D-' + dauer,\r\n    'ts', \r\n    'T-' + s.substring(11, 16).replace(':', '-'),\r\n    bt\r\n    );\r\n  return cn;\r\n}\r\n\r\nexport default Platz;\r\n","import React, { Component } from 'react';\r\nimport ScrollMenu from 'react-horizontal-scrolling-menu';\r\nimport {getDateArray} from \"./functions\";\r\nimport Config from './Defaults';\r\n\r\n\r\n// Das ist das Array mit den Tagen\r\nlet list = [];\r\n\r\n// One item component\r\n// selected prop will be passed\r\nconst MenuItem = ({ text, selected }) => {\r\n  return (\r\n    <div className={`dateBtn ${selected ? 'aktiv' : ''}`}>\r\n      {text}\r\n    </div>\r\n  );\r\n};\r\n\r\n// All items component\r\n// Important! add unique key\r\nexport const Menu = (list) => list.map(el => {\r\n  const { name, text } = el;\r\n\r\n  return (\r\n    <MenuItem\r\n      text={text}\r\n      key={name}\r\n    />\r\n  );\r\n});\r\n\r\nconst Arrow = ({ text, className }) => {\r\n  return (\r\n    <div\r\n      // className={className}\r\n      className=\"dateBtn arrowPicker\"\r\n    >{text}</div>\r\n  );\r\n};\r\n\r\nconst ArrowLeft = Arrow({ text: '<', className: 'arrow-prev' });\r\nconst ArrowRight = Arrow({ text: '>', className: 'arrow-next' });\r\n\r\nclass DayPicker extends Component {\r\n  state = {\r\n    selected: 0\r\n  };\r\n\r\n  componentWillMount() {\r\n    const {startswith, day} = this.props;\r\n    let end = new Date(day);\r\n    end.setDate(end.getDate() + Config.daypickerMaxDays);\r\n    list = getDateArray(startswith, end);\r\n    this.setState({selected: day});\r\n  }\r\n\r\n  onSelect = key => {\r\n    this.setState({ selected: key }, () => this.props.onClickHandler(key));\r\n  }\r\n  render() {\r\n    const { selected } = this.state;\r\n    // Create menu from items\r\n    const menu = Menu(list, selected);\r\n\r\n    return (\r\n      <div className=\"App\">\r\n        <ScrollMenu\r\n          data={menu}\r\n          arrowLeft={ArrowLeft}\r\n          arrowRight={ArrowRight}\r\n          selected={selected}\r\n          onSelect={this.onSelect}\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n\r\n}\r\n\r\nexport default DayPicker;\r\n  \r\n\r\n\r\n","import React, { Component } from 'react';\r\nimport Platz from \"./Platz\";\r\nimport DayPicker from \"./DayPicker\";\r\nimport \"./tafel.css\";\r\nimport SwipeableViews from 'react-swipeable-views';\r\nimport config from './Defaults';\r\nimport {formatDate, isValidDate} from \"./functions\";\r\nimport { Link } from 'react-router-dom';\r\n\r\n// Layout eines Tages\r\n\r\nclass Belegungstag extends Component {\r\n\r\n  constructor() {\r\n    super();\r\n    this.state = {\r\n      width: window.innerWidth,\r\n      day: '',\r\n      dayDate: '',\r\n    };\r\n  }    \r\n  componentWillMount() {\r\n    window.addEventListener('resize', this.handleWindowSizeChange);\r\n    let dayDate = this.props.match.params.day;\r\n    if ( ! isValidDate(new Date(dayDate)) ) {\r\n      dayDate = new Date();\r\n    } else {\r\n      dayDate = new Date(dayDate);\r\n    }\r\n    this.setState({ dayDate: dayDate, day: formatDate(dayDate) });\r\n    // let day = \"2019-05-02\";\r\n    this.setDay = this.setDay.bind(this);\r\n  }\r\n\r\n  // make sure to remove the listener\r\n  // when the component is not mounted anymore\r\n  componentWillUnmount() {\r\n    window.removeEventListener('resize', this.handleWindowSizeChange);\r\n  }\r\n\r\n  handleWindowSizeChange = () => {\r\n    this.setState({ width: window.innerWidth });\r\n  };\r\n\r\n  setDay(dString) {\r\n    const d = new Date(dString);\r\n    this.setState({dayDate: d, day: formatDate(d)});\r\n  }\r\n    \r\n  render() {\r\n    const { width } = this.state;\r\n    let firstDaypickerDay = new Date();\r\n\r\n    // //### TESTDATEN ###################\r\n    // firstDaypickerDay = new Date(2020, 4, 22);\r\n    \r\n    const isMobile = (width <= config.smartphoneWidth);\r\n    if (isMobile) {\r\n      firstDaypickerDay.setDate(firstDaypickerDay.getDate() - config.daypickerDaysBeforeToday);\r\n      const courtDiv = config.platzArray.map( (court) => {\r\n        return (\r\n          <div key={court} id={\"platz\" + court}>\r\n            <table className=\"table\">\r\n              <tbody>\r\n                <tr className=\"platzDim\">\r\n                  <td className=\"zeitleisteCol\"><Zeitleiste /></td>\r\n                  <td className=\"platz\">\r\n                    <div className=\"platznummer\">\r\n                      <span className=\"platzziffer\">{court}</span> \r\n                      <Link to={{pathname: '/intern/tafel/belegung', state: {c: court, d: this.state.day, op: 'new'} }}><img  className=\"neuBtn p-1 rounded-circle\" src=\"images/add.png\" alt=\"Neue Belegung\" /></Link> \r\n                    </div>\r\n                    <div>\r\n                      <Platz court={court} day={this.state.day} permissions={this.props.permissions} platzWide={true} />\r\n                    </div>\r\n                  </td>\r\n                </tr>\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        )\r\n      })\r\n      return (\r\n        <div>\r\n          <DayPicker startswith={firstDaypickerDay} day={this.state.day} onClickHandler={this.setDay} />\r\n          <SwipeableViews>\r\n            {courtDiv}\r\n          </SwipeableViews>\r\n          <Legende />\r\n        </div>\r\n      )\r\n    } else {\r\n      firstDaypickerDay.setDate(firstDaypickerDay.getDate() - config.daypickerDaysBeforeTodayWide);\r\n      const courtDiv = config.platzArray.map( (court) => {\r\n        return (<td key={court} id={\"platz\" + court} className=\"platz\">\r\n          <div>\r\n            <div className=\"platznummer\">\r\n              <span className=\"platzziffer rounded-circle\">{court}</span> \r\n              <Link to={{pathname: '/intern/tafel/belegung', state: {c: court, d: this.state.day, op: 'new'} }}><img  className=\"neuBtn p-1 rounded-circle\" src=\"images/add.png\" alt=\"Neue Belegung\" /></Link> \r\n            </div>\r\n            <div>            \r\n              <Platz court={court} day={this.state.day} permissions={this.props.permissions} platzWide={false} />\r\n              </div>\r\n            </div>\r\n          </td>\r\n        )\r\n      })\r\n      return (\r\n        <div>\r\n          <DayPicker startswith={firstDaypickerDay} day={this.state.day} onClickHandler={this.setDay} />\r\n          <table className=\"table\">\r\n            <tbody>\r\n              <tr className=\"platzDim\">\r\n                <td className=\"zeitleisteCol\"><Zeitleiste /> </td>\r\n                {courtDiv}\r\n              </tr>\r\n            </tbody>\r\n          </table>\r\n          <Legende />\r\n        </div>\r\n      )\r\n    }\r\n  }\r\n}\r\n\r\nconst Zeitleiste = () => {\r\n  let zeit = [];\r\n  for (let s = config.dailyStartTime; s <= config.dailyEndTime; s++) {\r\n    for (let m = 0; m < 60; m=m+60) {\r\n      zeit.push (s.toString().padStart(2, '0') + ':' + m.toString().padStart(2, '0'));\r\n    }\r\n  } \r\n  return (\r\n    <div className=\"zeitleiste\">\r\n      {\r\n        zeit.map((e, index) => \r\n          <React.Fragment key={index}>\r\n            <div className=\"stunde\"><div className=\"stundetext\">{e}</div></div>\r\n            <div className=\"viertelstunde\"></div>\r\n            <div className=\"viertelstunde\"></div>\r\n            <div className=\"viertelstunde\"></div>\r\n          </React.Fragment>\r\n        )\r\n      }\r\n    </div>\r\n  );\r\n}\r\n\r\nconst Legende = () => {\r\n  return (\r\n    <div className=\"container\">\r\n      <div className=\"row l-einzeldoppel p-0 pl-1 m-1\">Einzel/Doppel</div>\r\n      <div className=\"row l-turnier p-0 pl-1 m-1\">Turnier</div>\r\n      <div className=\"row l-trbuchung p-0 pl-1 m-1\">Trainerbuchung</div>\r\n      <div className=\"row l-veranstaltung p-0 pl-1 m-1\">Veranstaltung</div>\r\n      <div className=\"row l-punktspiele p-0 pl-1 m-1\">Punktspiele</div>\r\n      <div className=\"row l-training p-0 pl-1 m-1\">Training</div>\r\n      {/* <div className=\"row l-nichtreservierbar p-0 pl-1 m-1\">Frei verfügbar / Anderes</div> */}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Belegungstag;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","//\r\nimport React, { Component } from 'react';\r\nimport Config, { messages as Messages, permissions as Permissions } from './Defaults';\r\nimport { Redirect } from 'react-router';\r\nimport { spielerzusatz, servertimeNow, jugendlicher as isJugendlicher, getTimetable } from './functions';\r\nimport _ from 'lodash';\r\nimport Holidays from 'date-holidays';\r\n\r\nclass BelForm extends Component {\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    this.handleChange = this.handleChange.bind(this);\r\n    this.handleSave = this.handleSave.bind(this);\r\n    this.handleDelete = this.handleDelete.bind(this);\r\n\r\n    const { r } = props;\r\n    let [sd, st] = r.starts_at.split(' ')\r\n    // Daten für Datum, Start und Ende\r\n    let scd = new Date(r.starts_at)\r\n    let ssd = servertimeNow()\r\n\r\n    let timeDiff = scd.valueOf() - ssd.valueOf()\r\n    console.debug(\"ssd:\", ssd, \" scd:\", scd, \" timeDiff:\", timeDiff)\r\n    \r\n    const canBookForTomorrow = ( timeDiff < Config.std24) // 24*60*60*1000 = 24 Stunden in Millisekunden\r\n    console.debug(\"ssd:\", ssd, \" scd:\", scd, \" timeDiff:\", timeDiff, \" canBookForTomorrow:\", canBookForTomorrow)\r\n\r\n    // Initialer Wert für neue Buchungen. Wenn Einzel/Doppel erlaubt/nicht erlaubt sind, hier ändern\r\n    const bookingType = (r.booking_type === '') ? (canBookForTomorrow ? 'ts-einzel' : 'ts-turnier') : r.booking_type\r\n    const userDarfAlles = [Number([r.user_id]), Number([r.p1id]), Number([r.p2id]), Number([r.p3id]), Number([r.p4id])].includes(Number(this.props.userId))\r\n    const deleteActive = userDarfAlles || (Permissions.VORSTAND === (Permissions.VORSTAND & this.props.permissions))\r\n\r\n    let [ed, et] = r.ends_at.split(' ');\r\n    let sdA = sd.split('-');\r\n    this.state = {\r\n      r: r,\r\n      spieltag: sdA[2] + '.' + sdA[1] + '.' + sdA[0],\r\n      startsAtDate: sd,\r\n      endsAtDate: ed,\r\n      startsAt: st.substring(0, 5),\r\n      endsAt: et.substring(0, 5),\r\n      seriesId: r.series_id,\r\n      bookingType: bookingType,\r\n      comment: (typeof r.comment === \"undefined\") ? \"\" : r.comment,\r\n      p1: (r.p1id === 0 ? Number(this.props.userId) : Number(r.p1id)),\r\n      p2: Number(r.p2id),\r\n      p3: Number(r.p3id),\r\n      p4: Number(r.p4id),\r\n      spieler: [],\r\n      belegungenAbJetzt: [],\r\n      court: (typeof r.court === \"undefined\") ? \"--\" : r.court,\r\n      zurTafel: false,\r\n      saveActive: false,\r\n      deleteActive: deleteActive,\r\n      endeActive: false,\r\n      admin: false,\r\n      canBookForTomorrow: canBookForTomorrow,\r\n      overbooked: false,\r\n      jugend: false,\r\n      nichtVollBerechtigte: false,\r\n      timetable: [],\r\n      isLoading1: true,\r\n      isLoading2: true,\r\n      courtBelegt: [],\r\n    };\r\n\r\n  }\r\n\r\n  componentDidMount() {\r\n    // Alle Spieler für die Select-Auswahl laden    \r\n    let url = Config.protokoll + Config.hostname + \"/intern/api/spieler.php\";\r\n    this.setState({ isLoading1: true });\r\n    fetch(url, { credentials: 'same-origin' })\r\n      .then(result => {\r\n        if (result.ok) {\r\n          // console.log(result);\r\n          return result.json();\r\n        } else {\r\n          throw new Error('Fehler beim Laden der Spielerdaten');\r\n        }\r\n      })\r\n      .then(result => {\r\n        let spieler = result.records;\r\n        // console.log(spieler);\r\n        this.setState({ spieler: spieler, isLoading1: false })\r\n      })\r\n      .catch(error => this.setState({ error, isLoading1: false }));\r\n\r\n    // Alle Belegungen des Tages für die Belegungsprüfung laden\r\n    url = Config.protokoll + Config.hostname + \"/intern/api/belegungenabjetzt.php\";\r\n    this.setState({ isLoading2: true });\r\n    fetch(url, { credentials: 'same-origin' })\r\n      .then(result => {\r\n        if (result.ok) {\r\n          // console.log(result);\r\n          return result.json();\r\n        } else {\r\n          throw new Error('Fehler beim Laden der Belegungsdaten');\r\n        }\r\n      })\r\n      .then(result => {\r\n        // console.log(result.records)\r\n        // this.setState({ timetable: getBookableTimes(getTimetable(result.records)), isLoading2: false }); \r\n        this.setState({ timetable: getTimetable(result.records), isLoading2: false });\r\n\r\n      })\r\n      .catch(error => this.setState({ error, isLoading2: false }));\r\n\r\n  }\r\n\r\n  render() {\r\n    const { isLoading1, isLoading2 } = this.state;\r\n    if (isLoading1 || isLoading2) {\r\n      return <p>Loading...</p>\r\n    }\r\n    if (this.state.zurTafel === true) { \r\n      return <Redirect to={{ pathname: \"/intern/tafel/\", state: this.state.startsAtDate }} />\r\n    }\r\n    const condMF = (Permissions.MANNSCHAFTSFUEHRER === (Permissions.MANNSCHAFTSFUEHRER & this.props.permissions))\r\n    const condTrainer = (Permissions.TRAINER === (Permissions.MANNSCHAFTSFUEHRER & this.props.permissions))\r\n    return (\r\n      <div>\r\n        <h1>Spieltag: {this.state.spieltag}</h1>\r\n        <form className=\"form-inline\">\r\n          <fieldset className=\"fields\">\r\n            <div><strong>Buchungstyp</strong></div>\r\n            <select id=\"bookingType\" className=\"form-control\" onChange={this.handleChange} value={this.state.bookingType}>\r\n              <option disabled={!this.state.canBookForTomorrow} value=\"ts-einzel\">Einzel</option>\r\n              <option disabled={!this.state.canBookForTomorrow} value=\"ts-doppel\">Doppel</option>\r\n              <option value=\"ts-turnier\">Turnier</option>\r\n              <option disabled={!condMF} value=\"ts-veranstaltung\">Veranstaltung</option>\r\n              <option disabled={!condMF} value=\"ts-training\">Training</option>\r\n              <option disabled={!condMF} value=\"ts-punktspiele\">Punktspiele</option>\r\n              <option disabled={!condTrainer} value=\"ts-trbuchung\">Punktspiele</option>\r\n            </select>\r\n            <div><strong>Start</strong> <span id=\"startsAtMsg\" className={this.state.startsAtMsgClass}>{this.state.startsAtMsgTxt}</span></div>\r\n            <div className=\"form-group\">\r\n              <div>\r\n                <select id=\"startsAt\" className={'form-control ' + this.state.startsAtMsgClass} onChange={this.handleChange} value={this.state.startsAt}>\r\n                  {\r\n                    Object.keys(this.state.timetable).map(ttl => {\r\n\r\n                      return (\r\n                        <option key={ttl} value={ttl}>\r\n                          {ttl}h\r\n                          {/*\r\n                          &nbsp; {this.state.timetable[ttl][0]} \r\n                          &nbsp; {this.state.timetable[ttl][1]} \r\n                          &nbsp; {this.state.timetable[ttl][2]} \r\n                          &nbsp; {this.state.timetable[ttl][3]} \r\n                          &nbsp; {this.state.timetable[ttl][4]} \r\n                          &nbsp; {this.state.timetable[ttl][5]}\r\n                      */}\r\n                        </option>\r\n                      )\r\n                    })\r\n                  }\r\n                </select>\r\n              </div>\r\n            </div>\r\n            <div><strong>Platz</strong></div>\r\n            <div className=\"form-group\">\r\n              <select id=\"court\" className=\"form-control\" onChange={this.handleChange} value={this.state.court}>\r\n                <option value=\"--\">--</option>\r\n                <option disabled={this.state.courtBelegt[0]} value=\"1\">1</option>\r\n                <option disabled={this.state.courtBelegt[1]} value=\"2\">2</option>\r\n                <option disabled={this.state.courtBelegt[2]} value=\"3\">3</option>\r\n                <option disabled={this.state.courtBelegt[3]} value=\"4\">4</option>\r\n                <option disabled={this.state.courtBelegt[4]} value=\"5\">5</option>\r\n                <option disabled={this.state.courtBelegt[5]} value=\"6\">6</option>\r\n              </select>\r\n            </div>\r\n            <div><strong>Ende</strong></div>\r\n            <div className=\"form-group\">\r\n              <div>\r\n                <select id=\"endsAt\" className={'form-control ' + this.state.startsAtMsgClass} onChange={this.handleChange} value={this.state.endsAt}>\r\n                  {\r\n                    Object.keys(this.state.timetable).map(ttl => {\r\n                      return (\r\n                        // <option disabled={!this.state.endeActive} key={ttl} value={ttl}>\r\n                        <option key={ttl} value={ttl}>\r\n                          {ttl}h\r\n                          {/* &nbsp; {this.state.timetable[ttl][0]} \r\n                          &nbsp; {this.state.timetable[ttl][1]} \r\n                          &nbsp; {this.state.timetable[ttl][2]} \r\n                          &nbsp; {this.state.timetable[ttl][3]} \r\n                          &nbsp; {this.state.timetable[ttl][4]} \r\n                          &nbsp; {this.state.timetable[ttl][5]} */}\r\n                        </option>\r\n                      )\r\n                    })\r\n                  }\r\n                </select>\r\n              </div>\r\n\r\n            </div>\r\n            <div><strong>{(this.state.bookingType.match(/(ts-einzel)|(ts-doppel)|(ts-turnier)/ig)) ? 'Spieler' : 'Verantwortlicher'}</strong> <span id=\"p1Msg\" className={this.state.p1MsgClass}>{this.state.p1MsgTxt}</span></div>\r\n            <div className=\"form-row\">\r\n              <select id=\"p1\" className={'form-control ' + this.state.p1MsgFormCtrl} onChange={this.handleChange} value={this.state.p1}>\r\n                <option value=\"0\">- Bitte auswählen -</option>\r\n                {this.state.spieler.map(r => {\r\n                  return (\r\n                    <option key={'p1' + r.id} value={r.id}>{r.spieler + spielerzusatz(r.geburtsdatum, r.schnupper)}</option>\r\n                  )\r\n                })}\r\n              </select>\r\n              {(this.state.bookingType.match(/(ts-einzel)|(ts-turnier)|(ts-doppel)|(ts-trbuchung)/ig)) ?\r\n                <select id=\"p2\" className={'form-control ' + this.state.p1MsgFormCtrl} onChange={this.handleChange} value={this.state.p2}>\r\n                  <option value=\"0\">- Bitte auswählen -</option>\r\n                  {this.state.spieler.map(r => {\r\n                    return (\r\n                      <option key={'p2' + r.id} value={r.id}>{r.spieler + spielerzusatz(r.geburtsdatum, r.schnupper)}</option>\r\n                    )\r\n                  })}\r\n                </select>\r\n                : ''\r\n              }\r\n            </div>\r\n            <div className=\"form-row\">\r\n              {(this.state.bookingType === \"ts-doppel\") ?\r\n                <select id=\"p3\" className={'form-control ' + this.state.p1MsgFormCtrl} onChange={this.handleChange} value={this.state.p3}>\r\n                  <option value=\"0\">- Bitte auswählen -</option>\r\n                  {this.state.spieler.map(r => {\r\n                    return (\r\n                      <option key={'p3' + r.id} value={r.id}>{r.spieler + spielerzusatz(r.geburtsdatum, r.schnupper)}</option>\r\n                    )\r\n                  })}\r\n                </select>\r\n                : ''\r\n              }\r\n              {(this.state.bookingType === \"ts-doppel\") ?\r\n                <select id=\"p4\" className={'form-control ' + this.state.p1MsgFormCtrl} onChange={this.handleChange} value={this.state.p4}>\r\n                  <option value=\"0\">- Bitte auswählen -</option>\r\n                  {this.state.spieler.map(r => {\r\n                    return (\r\n                      <option key={'p4' + r.id} value={r.id}>{r.spieler + spielerzusatz(r.geburtsdatum, r.schnupper)}</option>\r\n                    )\r\n                  })}\r\n                </select>\r\n                : ''\r\n              }\r\n            </div>\r\n\r\n            <div><strong>Bemerkung</strong> <span id=\"commentMsg\" className={this.state.commentMsgClass}>{this.state.commentMsgTxt}</span></div>\r\n            <div className=\"form-group\">\r\n              <input type=\"text\" id=\"comment\" className={'form-control w-100 ' + this.state.p1MsgFormCtrl} onChange={this.handleChange} value={this.state.comment} placeholder=\"Spielergebnis, Gastname, ...\" />\r\n            </div>\r\n\r\n            <button type=\"submit\" onClick={e => { this.handleSave(e) }} className=\"btn btn-primary m-1\" disabled={!this.state.saveActive}>Speichern</button>\r\n            <button type=\"submit\" onClick={e => { this.handleDelete(e) }} className=\"btn btn-primary m-2\" disabled={!this.state.deleteActive}>Löschen</button>\r\n          </fieldset>\r\n        </form>\r\n      </div >\r\n    )\r\n  }\r\n\r\n  handleSave(e) {\r\n    e.preventDefault();\r\n    // console.log(\"SAVE FORM DATA NOW!\");\r\n    const s = {}\r\n    // Meldungen zurücksetzen\r\n    s.startsAtMsgTxt = ''\r\n    s.startsAtMsgClass = ''\r\n    s.saveActive = true\r\n    s.p1MsgFormCtrl = ''\r\n\r\n    let parameters =\r\n      '?op=cu'\r\n      + '&rid=' + this.state.r.id\r\n      + '&ds=' + this.state.startsAtDate + ' ' + this.state.startsAt\r\n      + '&de=' + this.state.endsAtDate + ' ' + this.state.endsAt\r\n      + '&uid=' + this.props.userId\r\n      + '&sid=' + this.state.seriesId\r\n      + '&p1=' + this.state.p1\r\n      + '&p2=' + this.state.p2\r\n      + '&p3=' + this.state.p3\r\n      + '&p4=' + this.state.p4\r\n      + '&c=' + this.state.court\r\n      + '&t=' + this.state.bookingType\r\n      + '&cmt=' + this.state.comment\r\n      + '&pr=0'\r\n      ;\r\n    let url = Config.protokoll + Config.hostname\r\n      + '/intern/api/platz.php'\r\n      + parameters;\r\n    // console.log(url);\r\n    fetch(url, { credentials: 'same-origin' })\r\n      .then(result => {\r\n        if (result.ok) {\r\n          return result.json()\r\n        } else {\r\n          throw new Error('Fehler beim Erzeugen/Updaten der Belegung' + this.state.r.id);\r\n        }\r\n      })\r\n      .then(result => {\r\n        let rc = result.records[0].returncode;\r\n        if (rc === 'ok') {\r\n          // Logging der Buchung\r\n          let logurl =\r\n            Config.protokoll\r\n            + Config.hostname\r\n            + Config.buchungenlog\r\n            + parameters;\r\n          fetch(logurl, { credentials: 'same-origin' }); // Wenn Logging fehlschlagen sollte, dann verzichten wir eben darauf\r\n          this.setState({ zurTafel: true })\r\n        } else if (rc === 'bereits belegt') {\r\n          // Fehlermeldung\r\n          [s.startsAtMsgClass, s.saveActive, s.startsAtMsgTxt] = Messages.platzbelegt;\r\n        } else {\r\n          // User nicht authentifiziert oder etwas stimmt generell nicht\r\n          window.location.href = Config.loginPage\r\n        }\r\n        // Alle Ergebnisse in den State\r\n        this.setState(s)\r\n      })\r\n  }\r\n\r\n  handleDelete(e) {\r\n\r\n    const sdStr = this.state.startsAtDate + 'T' + this.state.startsAt + \"Z\";\r\n    const sd = new Date(sdStr);\r\n    const jetzt = new Date();\r\n\r\n    e.preventDefault();\r\n\r\n    if (sd >= jetzt || (Permissions.VORSTAND & this.props.permissions)) {\r\n      let parameters =\r\n        '?op=d'\r\n        + '&rid=' + this.state.r.id\r\n        + '&uid=' + this.props.userId;\r\n      let url =\r\n        Config.protokoll\r\n        + Config.hostname\r\n        + Config.platzbuchungen\r\n        + parameters;\r\n      fetch(url, { credentials: 'same-origin' })\r\n        .then(result => {\r\n          if (result.ok) {\r\n            // Logging der Buchung\r\n            let logurl = Config.protokoll + Config.hostname\r\n              + Config.buchungenlog\r\n              + parameters;\r\n            fetch(logurl, { credentials: 'same-origin' });\r\n            this.setState({ zurTafel: true });\r\n          }\r\n        })\r\n    } else {\r\n      this.setState({ zurTafel: true });\r\n    }\r\n    e.preventDefault();\r\n\r\n  }\r\n\r\n  handleChange(e) {\r\n    e.preventDefault();\r\n\r\n    this.setState({ [e.target.id]: e.target.value }, () => {\r\n      const s = {}\r\n\r\n      // Meldungen zurücksetzen\r\n      s.p1MsgTxt = ''\r\n      s.p1MsgClass = ''\r\n      s.startsAtMsgTxt = ''\r\n      s.startsAtMsgClass = ''\r\n      s.commentMsgTxt = ''\r\n      s.commentMsgClass = ''\r\n\r\n      s.saveActive = true\r\n      s.deleteActive = true\r\n      s.endeActive = false\r\n      s.p1MsgFormCtrl = ''\r\n      s.overbooked = false\r\n      s.startsAt = this.state.startsAt\r\n      s.seriesId = this.state.seriesId\r\n      s.canBookForTomorrow = this.state.canBookForTomorrow\r\n\r\n      // Alle nicht buchbaren Zeiten der Timetable deaktivieren\r\n      // s.timetable = getBookableTimes(this.state.timetable)\r\n      s.timetable = this.state.timetable\r\n      // Belegte Plätze im Select disablen\r\n      s.courtBelegt = s.timetable[s.startsAt].map(c => c === Config.platzBelegt)\r\n\r\n      // Endezeit errechnen\r\n      let endsAtViertel = this.state.startsAt.substring(3, 5)\r\n      let endsAtStd = this.state.endsAt.substring(0, 2)\r\n      if (this.state.bookingType === \"ts-einzel\") {\r\n        endsAtStd = (Number(this.state.startsAt.substring(0, 2)) + 1).toLocaleString('de-DE', { minimumIntegerDigits: 2, useGrouping: false })\r\n      }\r\n      else if (this.state.bookingType === \"ts-doppel\") {\r\n        endsAtStd = (Number(this.state.startsAt.substring(0, 2)) + 2).toLocaleString('de-DE', { minimumIntegerDigits: 2, useGrouping: false })\r\n      }\r\n      else if (this.state.bookingType === \"ts-turnier\") {\r\n        if (!(Permissions.VORSTAND === (Permissions.VORSTAND & this.props.permissions))) {\r\n          endsAtStd = (Number(this.state.startsAt.substring(0, 2)) + 2).toLocaleString('de-DE', { minimumIntegerDigits: 2, useGrouping: false })\r\n        } else {\r\n          endsAtViertel = this.state.endsAt.substring(3, 5)\r\n        }\r\n      }\r\n      s.endsAt = endsAtStd + \":\" + endsAtViertel\r\n\r\n      // Bedingungen\r\n      let condEinGast = false\r\n      let condEinMitglied = false\r\n      let condEinSpielerErwVoll = false\r\n      let condDoppelteSpieler = false\r\n      let condUserIstSpieler = false\r\n\r\n      const datestring = this.state.startsAtDate + 'T' + this.state.startsAt + \"Z\"\r\n      const sd = new Date(datestring)\r\n      const hd = new Holidays()\r\n      hd.init('DE', 'BY')\r\n      const condFeiertag = hd.isHoliday(sd) ? true : false\r\n      const condSonnOderFeiertag = (condFeiertag || (sd.getDay() === 0) || (sd.getDay() === 6))\r\n      // const condPlatz6 = (Number(this.state.court) === 6)\r\n\r\n      // Validierung\r\n      // -----------\r\n      // Es wird validiert, ob Erwachsene, Schnuppermitglieder und Jugendliche \r\n      // wirklich spielberechtigt sind und ob die eingetragenen Zeiten stimmen\r\n\r\n      // Darf zu dieser Zeit gebucht werden? (max 24 Std im Voraus bei Einzel/Doppel)\r\n      let jetzt = servertimeNow().getTime()\r\n      let timeDiff = sd.getTime() - jetzt\r\n      s.canBookForTomorrow = ( timeDiff < Config.std24) // 24*60*60*1000 = 24 Stunden in Millisekunden\r\n      if ( !s.canBookForTomorrow && this.state.bookingType.match(/(ts-einzel)|(ts-doppel)/ig)) {\r\n          [s.p1MsgClass, s.saveActive, s.p1MsgTxt] = Messages.max24h;\r\n      }\r\n\r\n      // Buchungszeiten in Minuten\r\n      const start = Number(s.startsAt.substring(0, 2)) * 60 + Number(s.startsAt.substring(3, 5))\r\n      let ende = Number(s.endsAt.substring(0, 2)) * 60 + Number(s.endsAt.substring(3, 5))\r\n\r\n      const pKeys = [Number(this.state.p1), Number(this.state.p2), Number(this.state.p3), Number(this.state.p4)]\r\n\r\n      // Haben wir einen GAST oder ein Mitglied ohne Namen?\r\n      // Ist der aktuelle User auch Spieler?\r\n      // Ist ein erwachsenes Vollmitglied dabei?\r\n\r\n      const spieler = this.state.spieler;\r\n      condEinSpielerErwVoll = false\r\n      pKeys.forEach((p) => {\r\n        // eslint-disable-next-line\r\n        if (p != null && p != 0) // \r\n        {\r\n          if (p === Number(this.props.userId)) {\r\n            condUserIstSpieler = true\r\n          } if (p === Config.gastId || p === Config.gastJugId) {\r\n            condEinGast = true\r\n          } if (p === Config.mitgliedId) {\r\n            condEinMitglied = true\r\n          }\r\n          // Geburtsdatum und Schnupperstatus prüfen wir mittels spieler-SELECT-Array\r\n          let pAttr = spieler.find(o => o.id === p.toString())\r\n          if (!(isJugendlicher(pAttr['geburtsdatum']) || pAttr['schnupper'] === \"1\")) {\r\n            condEinSpielerErwVoll = true\r\n          }\r\n        }\r\n      })\r\n      // Auch der Ersteller der Buchung ist zu allem berechtigt\r\n      condUserIstSpieler = condUserIstSpieler || this.props.userId === this.state.r.user_id\r\n\r\n      let saveActiveMerker = true\r\n      // Message an der Spielzeit\r\n      // Formal müssen Spieler korrekt eingetragen sein\r\n      if (this.state.bookingType.match(/(ts-veranstaltung)|(ts-training)|(ts-nichtreservierbar)/ig)) {\r\n        // Ein Spieler muss eingetragen werden\r\n        if (Number(this.state.p1) === 0) {\r\n          [s.p1msgClass, s.saveActive, s.p1MsgTxt] = Messages.spieleranzahl\r\n          s.p1MsgFormCtrl = 'is-invalid'\r\n        }\r\n        // Spieler 2 bis 4 werden \"gelöscht\"\r\n        s.p2 = s.p3 = s.p4 = 0\r\n      }\r\n      saveActiveMerker = (saveActiveMerker === true) ? s.saveActive : false\r\n\r\n      if (this.state.bookingType.match(/(ts-turnier)|(ts-einzel)|ts-trbuchung/ig)) {\r\n        // Zwei Spieler müssen eingetragen werden, beide nicht 0 und unterschiedlich\r\n        if (Number(this.state.p1) === 0 || Number(this.state.p2) === 0) {\r\n          [s.p1msgClass, s.saveActive, s.p1MsgTxt] = Messages.spieleranzahl;\r\n          s.p1MsgFormCtrl = 'is-invalid'\r\n        } else if (Number(this.state.p1) === Number(this.state.p2)) {\r\n          // Sind die Spieler doppelt?\r\n          condDoppelteSpieler = true;\r\n          [s.p1msgClass, s.saveActive, s.p1MsgTxt] = Messages.spieleranzahl;\r\n          s.p1MsgFormCtrl = 'is-invalid'\r\n        }\r\n        // Spieler 3 bis 4 werden \"gelöscht\"\r\n        s.p3 = s.p4 = 0\r\n      }\r\n      saveActiveMerker = (saveActiveMerker === true) ? s.saveActive : false\r\n\r\n      if (this.state.bookingType === \"ts-doppel\") {\r\n        // Vier Spieler\r\n        // Sind unter 4 Spielern welche doppelt?\r\n        condDoppelteSpieler = (_.uniq([this.state.p1, this.state.p2, this.state.p3, this.state.p4]).length < 4)\r\n\r\n        if (!condEinGast) {\r\n          if (condDoppelteSpieler || (Number(this.state.p3) === 0 || Number(this.state.p4) === 0)) {\r\n            [s.p1MsgClass, s.saveActive, s.p1MsgTxt] = Messages.spieleranzahl;\r\n            s.p1MsgFormCtrl = 'is-invalid'\r\n          }\r\n        }\r\n      }\r\n      saveActiveMerker = (saveActiveMerker === true) ? s.saveActive : false\r\n\r\n      if (condEinGast || condEinMitglied) {\r\n        if (this.state.bookingType.match(/(ts-einzel)|(ts-doppel)|(ts-trbuchung)/ig)) {\r\n          // Gäste und unbenannte Mitglieder müssen einen Kommentar/Namen vermerken. Mind. 2 Zeichen\r\n          if (this.state.comment.length < 2) {\r\n            [s.commentMsgClass, s.saveActive, s.commentMsgTxt] = condEinGast ? Messages.gast : Messages.mitglied\r\n            s.p1MsgFormCtrl = 'is-invalid'\r\n          }\r\n        }\r\n        else {\r\n          [s.p1MsgClass, s.saveActive, s.p1MsgTxt] = Messages.spieleranzahl;\r\n          s.p1MsgFormCtrl = 'is-invalid'\r\n        }\r\n      }\r\n      if (this.state.bookingType === \"ts-veranstaltung\") {\r\n        [s.commentMsgClass, s.saveActive, s.commentMsgTxt] = Messages.veranstaltung\r\n      }\r\n      saveActiveMerker = (saveActiveMerker === true) ? s.saveActive : false\r\n\r\n      if (this.state.bookingType.match(/(ts-einzel)|(ts-doppel)/ig)) {\r\n        // Jetzt die Berechtigungen nach Alter, Status, Zeitpunkt. Message an der Spielzeit\r\n        // Diese Bedingungen sind von der Entscheidungstabelle (Dokumentation, Excel) abgeleitet\r\n        const dToday = new Date()\r\n\r\n        const dH = dToday.getHours()\r\n        const dM = dToday.getMinutes()\r\n        const minutesToday = (dH * 60 + dM)\r\n        if ((start - minutesToday) > Config.maxMinutesDistance && !condEinSpielerErwVoll && !condSonnOderFeiertag && ende > (Config.eveningTime / 100 * 60)) {\r\n          [s.startsAtMsgClass, s.saveActive, s.startsAtMsgTxt] = Messages.erwachsenenvorrecht;\r\n          s.overbooked = true\r\n        }\r\n      }\r\n      saveActiveMerker = (saveActiveMerker === true) ? s.saveActive : false\r\n\r\n      // Auswertung Spielzeit formal, Message an der Spielzeit\r\n      if (start >= ende) {\r\n        [s.startsAtMsgClass, s.saveActive, s.startsAtMsgTxt] = Messages.zeit;\r\n      }\r\n      else if (this.state.bookingType === \"ts-einzel\") {\r\n        if ((ende - start) > Config.singleTime) {\r\n          [s.startsAtMsgClass, s.saveActive, s.startsAtMsgTxt] = Messages.einzeldauer;\r\n        }\r\n      }\r\n      else if (this.state.bookingType === \"ts-doppel\") {\r\n        if ((ende - start) > Config.doubleTime) {\r\n          [s.startsAtMsgClass, s.saveActive, s.startsAtMsgTxt] = Messages.doppeldauer;\r\n        }\r\n      }\r\n      else if (this.state.bookingType === \"ts-turnier\") {\r\n        if ((ende - start) !== Config.turnierTime && (Permissions.VORSTAND !== (Permissions.VORSTAND & this.props.permissions))) {\r\n          [s.startsAtMsgClass, s.saveActive, s.startsAtMsgTxt] = Messages.turnierspieldauer;\r\n        } else {\r\n          [s.startsAtMsgClass, s.saveActive, s.startsAtMsgTxt] = Messages.turnier;\r\n        }\r\n      }\r\n      saveActiveMerker = (saveActiveMerker === true) ? s.saveActive : false\r\n\r\n      // Berechtigung zum Speichern und Löschen und flexible Endezeit\r\n      if (this.state.bookingType.match(/(ts-turnier)/ig)) {\r\n        s.saveActive = (Permissions.VORSTAND === (Permissions.VORSTAND & this.props.permissions))\r\n        s.deleteActive = (Permissions.VORSTAND === (Permissions.VORSTAND & this.props.permissions))\r\n        s.endeActive = false\r\n      }\r\n      if (this.state.bookingType.match(/(ts-einzel)|(ts-doppel)/ig)) {\r\n        s.saveActive = condUserIstSpieler || (Permissions.VORSTAND === (Permissions.VORSTAND & this.props.permissions))\r\n        s.deleteActive = condUserIstSpieler || (Permissions.VORSTAND === (Permissions.VORSTAND & this.props.permissions))\r\n        s.endeActive = false\r\n      }\r\n      if (this.state.bookingType.match(/(ts-trbuchung)/ig)) {\r\n        s.saveActive = condUserIstSpieler || (Permissions.TRAINER === (Permissions.TRAINER & this.props.permissions))\r\n        s.deleteActive = condUserIstSpieler || (Permissions.TRAINER === (Permissions.TRAINER & this.props.permissions))\r\n        s.endeActive = false\r\n      }\r\n      if (this.state.bookingType.match(/(ts-training)|(ts-punktspiele)|(ts-nichtreservierbar)|(ts-veranstaltung)/ig)) {\r\n        s.saveActive = (Permissions.MANNSCHAFTSFUEHRER === (Permissions.MANNSCHAFTSFUEHRER & this.props.permissions))\r\n        s.endeActive = true\r\n      }\r\n      if (this.state.bookingType.match(/(ts-training)|(ts-punktspiele)|(ts-nichtreservierbar)|(ts-veranstaltung)/ig)) {\r\n        s.deleteActive = (Permissions.MANNSCHAFTSFUEHRER === (Permissions.MANNSCHAFTSFUEHRER & this.props.permissions))\r\n      }\r\n      saveActiveMerker = (saveActiveMerker === true) ? s.saveActive : false\r\n\r\n      s.saveActive = saveActiveMerker\r\n\r\n      // Alle Ergebnisse in den State\r\n      this.setState(s)\r\n\r\n    });\r\n  }\r\n}\r\n\r\nexport default BelForm;\r\n\r\n\r\n\r\n","//\r\nimport React, { Component } from 'react';\r\nimport Config, { messages as Messages, permissions as Permissions } from './Defaults';\r\nimport { Redirect } from 'react-router';\r\nimport { spielerzusatz, servertimeNow, jugendlicher as isJugendlicher, getTimetable } from './functions';\r\nimport Holidays from 'date-holidays';\r\n\r\nclass BelFormTrBuchung extends Component {\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    this.handleChange = this.handleChange.bind(this);\r\n    this.handleSave = this.handleSave.bind(this);\r\n    this.handleDelete = this.handleDelete.bind(this);\r\n\r\n    const { r } = props;\r\n    let [sd, st] = r.starts_at.split(' ')\r\n    // Daten für Datum, Start und Ende\r\n    let scd = new Date(r.starts_at)\r\n    let ssd = servertimeNow()\r\n\r\n    let timeDiff = scd.valueOf() - ssd.valueOf()\r\n    // console.debug(\"ssd:\", ssd, \" scd:\", scd, \" timeDiff:\", timeDiff)\r\n    \r\n    const userDarfLoeschen = ( timeDiff > Config.std24) // 24*60*60*1000 = 24 Stunden in Millisekunden\r\n    // console.debug(\"ssd:\", ssd, \" scd:\", scd, \" timeDiff:\", timeDiff, \" userDarfLoeschen:\", userDarfLoeschen)\r\n\r\n    // Initialer Wert für neue Buchungen. Wenn Einzel/Doppel erlaubt/nicht erlaubt sind, hier ändern\r\n    const bookingType = r.booking_type\r\n    const userDarfAlles = userDarfLoeschen && ([Number([r.user_id]), Number([r.p1id]), Number([r.p2id]), Number([r.p3id]), Number([r.p4id])].includes(Number(this.props.userId)))\r\n    const deleteActive = userDarfAlles || (Permissions.VORSTAND === (Permissions.VORSTAND & this.props.permissions))\r\n\r\n    let [ed, et] = r.ends_at.split(' ');\r\n    let sdA = sd.split('-');\r\n    this.state = {\r\n      r: r,\r\n      spieltag: sdA[2] + '.' + sdA[1] + '.' + sdA[0],\r\n      startsAtDate: sd,\r\n      endsAtDate: ed,\r\n      startsAt: st.substring(0, 5),\r\n      endsAt: et.substring(0, 5),\r\n      seriesId: r.series_id,\r\n      bookingType: bookingType,\r\n      comment: (typeof r.comment === \"undefined\") ? \"\" : r.comment,\r\n      p1: Number(r.p1id),\r\n      p2: Number(r.p2id),\r\n      p3: Number(r.p3id),\r\n      p4: Number(r.p4id),\r\n      spieler: [],\r\n      belegungenAbJetzt: [],\r\n      court: (typeof r.court === \"undefined\") ? \"--\" : r.court,\r\n      zurTafel: false,\r\n      saveActive: false,\r\n      deleteActive: deleteActive,\r\n      endeActive: false,\r\n      admin: false,\r\n      userDarfLoeschen: userDarfLoeschen,\r\n      overbooked: false,\r\n      jugend: false,\r\n      nichtVollBerechtigte: false,\r\n      timetable: [],\r\n      isLoading1: true,\r\n      isLoading2: true,\r\n      courtBelegt: [],\r\n    };\r\n\r\n  }\r\n\r\n  componentDidMount() {\r\n    // Alle Spieler für die Select-Auswahl laden    \r\n    let url = Config.protokoll + Config.hostname + \"/intern/api/spieler.php\";\r\n    this.setState({ isLoading1: true });\r\n    fetch(url, { credentials: 'same-origin' })\r\n      .then(result => {\r\n        if (result.ok) {\r\n          // console.log(result);\r\n          return result.json();\r\n        } else {\r\n          throw new Error('Fehler beim Laden der Spielerdaten');\r\n        }\r\n      })\r\n      .then(result => {\r\n        let spieler = result.records;\r\n        // console.log(spieler);\r\n        this.setState({ spieler: spieler, isLoading1: false })\r\n      })\r\n      .catch(error => this.setState({ error, isLoading1: false }));\r\n\r\n    // Alle Belegungen des Tages für die Belegungsprüfung laden\r\n    url = Config.protokoll + Config.hostname + \"/intern/api/belegungenabjetzt.php\";\r\n    this.setState({ isLoading2: true });\r\n    fetch(url, { credentials: 'same-origin' })\r\n      .then(result => {\r\n        if (result.ok) {\r\n          // console.log(result);\r\n          return result.json();\r\n        } else {\r\n          throw new Error('Fehler beim Laden der Belegungsdaten');\r\n        }\r\n      })\r\n      .then(result => {\r\n        // console.log(result.records)\r\n        // this.setState({ timetable: getBookableTimes(getTimetable(result.records)), isLoading2: false }); \r\n        this.setState({ timetable: getTimetable(result.records), isLoading2: false });\r\n\r\n      })\r\n      .catch(error => this.setState({ error, isLoading2: false }));\r\n\r\n  }\r\n\r\n  render() {\r\n    const { isLoading1, isLoading2 } = this.state;\r\n    if (isLoading1 || isLoading2) {\r\n      return <p>Loading...</p>\r\n    }\r\n    if (this.state.zurTafel === true) { \r\n      return <Redirect to={{ pathname: \"/intern/tafel/\", state: this.state.startsAtDate }} />\r\n    }\r\n    const trainer = this.state.spieler.find(sp => sp.id === this.state.p1.toString())\r\n    return (\r\n      <div>\r\n        <h1>Spieltag: {this.state.spieltag}</h1>\r\n        <form className=\"form-inline\">\r\n          <fieldset className=\"fields\">\r\n            <div><strong>Buchungstyp:</strong> <span>{this.state.bookingType}</span></div>\r\n\r\n            <div><strong>Platz</strong> <span>{this.state.court}</span></div>\r\n            <div><strong>Start</strong> <span>{this.state.startsAt}</span></div>\r\n            <div><strong>Ende</strong> <span>{this.state.endsAt}</span></div>\r\n            <div><strong>Trainer</strong> <span>{trainer.spieler}</span></div>\r\n\r\n            <div><strong>Spieler</strong> <span id=\"p1Msg\" className={this.state.p1MsgClass}>{this.state.p1MsgTxt}</span></div>\r\n            <div className=\"form-row\">\r\n              <select id=\"p1\" className={'form-control ' + this.state.p1MsgFormCtrl} onChange={this.handleChange} value={this.state.p1}>\r\n                <option value=\"0\">- Bitte auswählen -</option>\r\n                {this.state.spieler.map(r => {\r\n                  return (\r\n                    <option key={'p1' + r.id} value={r.id}>{r.spieler + spielerzusatz(r.geburtsdatum, r.schnupper)}</option>\r\n                  )\r\n                })}\r\n              </select>\r\n            </div>\r\n            <div><strong>Bemerkung</strong> <span id=\"commentMsg\" className={this.state.commentMsgClass}>{this.state.commentMsgTxt}</span></div>\r\n            <div className=\"form-group\">\r\n              <input type=\"text\" id=\"comment\" className={'form-control w-100 ' + this.state.p1MsgFormCtrl} onChange={this.handleChange}\r\n               value={this.state.comment} placeholder=\"Weitere Spieler, ...\" />\r\n            </div>\r\n\r\n            <button type=\"submit\" onClick={e => { this.handleSave(e) }} className=\"btn btn-primary m-1\" disabled={!this.state.saveActive}>Speichern</button>\r\n            <button type=\"submit\" onClick={e => { this.handleDelete(e) }} className=\"btn btn-primary m-2\" disabled={!this.state.deleteActive}>Löschen</button>\r\n          </fieldset>\r\n        </form>\r\n      </div >\r\n    )\r\n  }\r\n\r\n  handleSave(e) {\r\n    e.preventDefault();\r\n    // console.log(\"SAVE FORM DATA NOW!\");\r\n    const s = {}\r\n    // Meldungen zurücksetzen\r\n    s.startsAtMsgTxt = ''\r\n    s.startsAtMsgClass = ''\r\n    s.saveActive = true\r\n    s.p1MsgFormCtrl = ''\r\n\r\n    let parameters =\r\n      '?op=cu'\r\n      + '&rid=' + this.state.r.id\r\n      + '&ds=' + this.state.startsAtDate + ' ' + this.state.startsAt\r\n      + '&de=' + this.state.endsAtDate + ' ' + this.state.endsAt\r\n      + '&uid=' + this.props.userId\r\n      + '&sid=' + this.state.seriesId\r\n      + '&p1=' + this.state.p1\r\n      + '&p2=' + this.state.p2\r\n      + '&p3=' + this.state.p3\r\n      + '&p4=' + this.state.p4\r\n      + '&c=' + this.state.court\r\n      + '&t=' + this.state.bookingType\r\n      + '&cmt=' + this.state.comment\r\n      + '&pr=0'\r\n      ;\r\n    let url = Config.protokoll + Config.hostname\r\n      + '/intern/api/platz.php'\r\n      + parameters;\r\n    // console.log(url);\r\n    fetch(url, { credentials: 'same-origin' })\r\n      .then(result => {\r\n        if (result.ok) {\r\n          return result.json()\r\n        } else {\r\n          throw new Error('Fehler beim Erzeugen/Updaten der Belegung' + this.state.r.id);\r\n        }\r\n      })\r\n      .then(result => {\r\n        let rc = result.records[0].returncode;\r\n        if (rc === 'ok') {\r\n          // Logging der Buchung\r\n          let logurl =\r\n            Config.protokoll\r\n            + Config.hostname\r\n            + Config.buchungenlog\r\n            + parameters;\r\n          fetch(logurl, { credentials: 'same-origin' }); // Wenn Logging fehlschlagen sollte, dann verzichten wir eben darauf\r\n          this.setState({ zurTafel: true })\r\n        } else if (rc === 'bereits belegt') {\r\n          // Fehlermeldung\r\n          [s.startsAtMsgClass, s.saveActive, s.startsAtMsgTxt] = Messages.platzbelegt;\r\n        } else {\r\n          // User nicht authentifiziert oder etwas stimmt generell nicht\r\n          window.location.href = Config.loginPage\r\n        }\r\n        // Alle Ergebnisse in den State\r\n        this.setState(s)\r\n      })\r\n  }\r\n\r\n  handleDelete(e) {\r\n\r\n    const sdStr = this.state.startsAtDate + 'T' + this.state.startsAt + \"Z\";\r\n    const sd = new Date(sdStr);\r\n    const jetzt = new Date();\r\n\r\n    e.preventDefault();\r\n\r\n    if (sd >= jetzt || (Permissions.VORSTAND & this.props.permissions)) {\r\n      let parameters =\r\n        '?op=d'\r\n        + '&rid=' + this.state.r.id\r\n        + '&uid=' + this.props.userId;\r\n      let url =\r\n        Config.protokoll\r\n        + Config.hostname\r\n        + Config.platzbuchungen\r\n        + parameters;\r\n      fetch(url, { credentials: 'same-origin' })\r\n        .then(result => {\r\n          if (result.ok) {\r\n            // Logging der Buchung\r\n            let logurl = Config.protokoll + Config.hostname\r\n              + Config.buchungenlog\r\n              + parameters;\r\n            fetch(logurl, { credentials: 'same-origin' });\r\n            this.setState({ zurTafel: true });\r\n          }\r\n        })\r\n    } else {\r\n      this.setState({ zurTafel: true });\r\n    }\r\n    e.preventDefault();\r\n\r\n  }\r\n\r\n  handleChange(e) {\r\n    e.preventDefault();\r\n\r\n    this.setState({ [e.target.id]: e.target.value }, () => {\r\n      const s = {}\r\n\r\n      // Meldungen zurücksetzen\r\n      s.p1MsgTxt = ''\r\n      s.p1MsgClass = ''\r\n      s.startsAtMsgTxt = ''\r\n      s.startsAtMsgClass = ''\r\n      s.commentMsgTxt = ''\r\n      s.commentMsgClass = ''\r\n\r\n      s.saveActive = true\r\n      s.deleteActive = true\r\n      s.endeActive = false\r\n      s.p1MsgFormCtrl = ''\r\n      s.overbooked = false\r\n      s.startsAt = this.state.startsAt\r\n      s.seriesId = this.state.seriesId\r\n      s.userDarfLoeschen = this.state.userDarfLoeschen\r\n\r\n      // Alle nicht buchbaren Zeiten der Timetable deaktivieren\r\n      // s.timetable = getBookableTimes(this.state.timetable)\r\n      s.timetable = this.state.timetable\r\n      // Belegte Plätze im Select disablen\r\n      s.courtBelegt = s.timetable[s.startsAt].map(c => c === Config.platzBelegt)\r\n\r\n      // Endezeit errechnen\r\n      let endsAtViertel = this.state.startsAt.substring(3, 5)\r\n      let endsAtStd = this.state.endsAt.substring(0, 2)\r\n      if (this.state.bookingType === \"ts-einzel\") {\r\n        endsAtStd = (Number(this.state.startsAt.substring(0, 2)) + 1).toLocaleString('de-DE', { minimumIntegerDigits: 2, useGrouping: false })\r\n      }\r\n      else if (this.state.bookingType === \"ts-doppel\") {\r\n        endsAtStd = (Number(this.state.startsAt.substring(0, 2)) + 2).toLocaleString('de-DE', { minimumIntegerDigits: 2, useGrouping: false })\r\n      }\r\n      else if (this.state.bookingType === \"ts-turnier\") {\r\n        if (!(Permissions.VORSTAND === (Permissions.VORSTAND & this.props.permissions))) {\r\n          endsAtStd = (Number(this.state.startsAt.substring(0, 2)) + 2).toLocaleString('de-DE', { minimumIntegerDigits: 2, useGrouping: false })\r\n        } else {\r\n          endsAtViertel = this.state.endsAt.substring(3, 5)\r\n        }\r\n      }\r\n      s.endsAt = endsAtStd + \":\" + endsAtViertel\r\n\r\n      // Bedingungen\r\n      let condEinGast = false\r\n      let condEinMitglied = false\r\n      let condEinSpielerErwVoll = false\r\n      let condUserIstSpieler = false\r\n\r\n      const datestring = this.state.startsAtDate + 'T' + this.state.startsAt + \"Z\"\r\n      const sd = new Date(datestring)\r\n      const hd = new Holidays()\r\n      hd.init('DE', 'BY')\r\n      const condFeiertag = hd.isHoliday(sd) ? true : false\r\n      const condSonnOderFeiertag = (condFeiertag || (sd.getDay() === 0) || (sd.getDay() === 6))\r\n      // const condPlatz6 = (Number(this.state.court) === 6)\r\n\r\n      // Validierung\r\n      // -----------\r\n      // Es wird validiert, ob Erwachsene, Schnuppermitglieder und Jugendliche \r\n      // wirklich spielberechtigt sind und ob die eingetragenen Zeiten stimmen\r\n\r\n\r\n      // Buchungszeiten in Minuten\r\n      const start = Number(s.startsAt.substring(0, 2)) * 60 + Number(s.startsAt.substring(3, 5))\r\n      let ende = Number(s.endsAt.substring(0, 2)) * 60 + Number(s.endsAt.substring(3, 5))\r\n\r\n      const pKeys = [Number(this.state.p1), Number(this.state.p2), Number(this.state.p3), Number(this.state.p4)]\r\n\r\n      // Haben wir einen GAST oder ein Mitglied ohne Namen?\r\n      // Ist der aktuelle User auch Spieler?\r\n      // Ist ein erwachsenes Vollmitglied dabei?\r\n\r\n      const spieler = this.state.spieler;\r\n      condEinSpielerErwVoll = false\r\n      pKeys.forEach((p) => {\r\n        // eslint-disable-next-line\r\n        if (p != null && p != 0) // \r\n        {\r\n          if (p === Number(this.props.userId)) {\r\n            condUserIstSpieler = true\r\n          } if (p === Config.gastId || p === Config.gastJugId) {\r\n            condEinGast = true\r\n          } if (p === Config.mitgliedId) {\r\n            condEinMitglied = true\r\n          }\r\n          // Geburtsdatum und Schnupperstatus prüfen wir mittels spieler-SELECT-Array\r\n          let pAttr = spieler.find(o => o.id === p.toString())\r\n          if (!(isJugendlicher(pAttr['geburtsdatum']) || pAttr['schnupper'] === \"1\")) {\r\n            condEinSpielerErwVoll = true\r\n          }\r\n        }\r\n      })\r\n      // Auch der Ersteller der Buchung ist zu allem berechtigt\r\n      condUserIstSpieler = condUserIstSpieler || this.props.userId === this.state.r.user_id\r\n\r\n      let saveActiveMerker = true\r\n      // Formal müssen Spieler korrekt eingetragen sein\r\n\r\n      // Ein Spieler muss eingetragen werden. p1 < 50 sind reserviert IDs \r\n      if (Number(this.state.p1) < 50) {\r\n        [s.p1msgClass, s.saveActive, s.p1MsgTxt] = Messages.spieleranzahl;\r\n        s.p1MsgFormCtrl = 'is-invalid'\r\n      } \r\n      \r\n      saveActiveMerker = (saveActiveMerker === true) ? s.saveActive : false\r\n\r\n      if (condEinGast || condEinMitglied) {\r\n        // Gäste und unbenannte Mitglieder müssen einen Kommentar/Namen vermerken. Mind. 2 Zeichen\r\n        if (this.state.comment.length < 2) {\r\n          [s.commentMsgClass, s.saveActive, s.commentMsgTxt] = condEinGast ? Messages.gast : Messages.mitglied\r\n          s.p1MsgFormCtrl = 'is-invalid'\r\n        }\r\n      }\r\n      saveActiveMerker = (saveActiveMerker === true) ? s.saveActive : false\r\n\r\n      s.saveActive = saveActiveMerker\r\n\r\n      // Alle Ergebnisse in den State\r\n      this.setState(s)\r\n\r\n    });\r\n  }\r\n}\r\n\r\n\r\nexport default BelFormTrBuchung;\r\n\r\n\r\n\r\n","import React, { Component } from 'react';\r\nimport BelForm from './BelForm';\r\nimport BelFormTrBuchung from './BelFormTrBuchung';\r\nimport { Link } from 'react-router-dom';\r\nimport Config from './Defaults';\r\n\r\nclass Belegung extends Component {\r\n  \r\n  constructor(props) {\r\n    super(props);\r\n    \r\n    this.state = { \r\n      belegung : [],\r\n      isLoading : false,\r\n      error : false,\r\n    };\r\n  }  \r\n  componentWillMount() {\r\n    const {op} = this.props.location.state;\r\n    if (op === \"update\") {\r\n      const {i, d} = this.props.location.state;\r\n      this.updateBel(i, d);\r\n    } else if (op === \"new\") {\r\n      const {c, d} = this.props.location.state;\r\n      this.newBel(c, d);\r\n    }\r\n  }\r\n  \r\n  updateBel(id, day) {\r\n    const url = Config.protokoll + Config.hostname + \"/intern/api/platz.php?op=r&rid=\" + id;\r\n  \r\n    this.setState({isLoading : true});\r\n    \r\n    fetch(url, {credentials: 'same-origin'})\r\n    .then(result => {\r\n      if (result.ok) {\r\n        if (result.redirected) {\r\n          // console.log(\"BelDetails.js/Checkuser: Authentifizierungsfehler\")\r\n          window.location.href = result.url\r\n        }\r\n        return result.json();\r\n      } else {\r\n        throw new Error('Fehler beim Laden der Platzbuchungsdetails');\r\n      }\r\n    })\r\n    .then(result => {\r\n      let belegung = result.records.map( r => {\r\n        if (r.booking_type === \"ts-trbuchung\")\r\n        {\r\n          return (\r\n            <div key={r.id} className=\"p-2\">\r\n                <Link to={{ pathname: '/intern/tafel/', state: {d: day} }}><p className=\"btn btn-secondary\">Zurück</p></Link>\r\n                <BelFormTrBuchung r={r} userId={this.props.userId} permissions={this.props.permissions} />\r\n            </div>\r\n          )\r\n        } else \r\n        {\r\n          return (\r\n            <div key={r.id} className=\"p-2\">\r\n                <Link to={{ pathname: '/intern/tafel/', state: {d: day} }}><p className=\"btn btn-secondary\">Zurück</p></Link>\r\n                <BelForm r={r} userId={this.props.userId} permissions={this.props.permissions} />\r\n            </div>\r\n          )\r\n        }\r\n      })\r\n      this.setState({ belegung: belegung })\r\n    })\r\n    .catch(error => this.setState({ error, isLoading: false }));\r\n  }\r\n  \r\n  newBel(court, day)\r\n  {\r\n    let r = getEmptyBel(court, day);\r\n    let belegung = [\r\n        <div key={-1} className=\"p-2\">\r\n            <Link to={{ pathname: '/intern/tafel/', state: {d: day} }}><p className=\"btn btn-secondary\">Zurück</p></Link>\r\n            <BelForm r={r} userId={this.props.userId} permissions={this.props.permissions} />\r\n        </div>\r\n    ];\r\n    this.setState({ belegung: belegung })\r\n  }\r\n  \r\n  render() {\r\n    return (\r\n      <div>{this.state.belegung}</div>\r\n    );\r\n  }\r\n}\r\n\r\nfunction getEmptyBel(court, day) {\r\n  return {\r\n    id: 0,\r\n    user_id: 0,\r\n    series_id: '',\r\n    p1: '',\r\n    p2: '',\r\n    p3: '',\r\n    p4: '',\r\n    court: court,\r\n    starts_at: day + ' 08:00:00',\r\n    ends_at: day + ' 09:00:00',\r\n    booking_type: '',\r\n    geburtsdatum: '0000-00-00',\r\n    p1id: 0,\r\n    p2id: 0,\r\n    p3id: 0,\r\n    p4id: 0,    \r\n  }\r\n}\r\nexport default Belegung;\r\n  ","import React, { Component } from 'react';\r\nimport { Route, Switch } from 'react-router-dom';\r\nimport Belegungstag from './Belegungstag';\r\nimport Belegung from './Belegung';\r\n\r\n\r\nclass Routing extends Component {\r\n    render() {\r\n      return (\r\n        <Switch>\r\n          <Route exact path='/intern/tafel/belegung' render={(props) => <Belegung {...props} userId={this.props.userId} permissions={this.props.permissions} />} />\r\n          <Route render={(props) => <Belegungstag {...props} userId={this.props.userId} permissions={this.props.permissions} />} />\r\n        </Switch>\r\n      )\r\n    }\r\n}\r\n\r\n\r\nexport default Routing;\r\n  ","import React, { Component } from 'react';\r\nimport Routing from \"./Routing\";\r\nimport Config from \"./Defaults\";\r\n\r\n\r\nclass App extends Component \r\n{\r\n  constructor(props) {\r\n    super(props);\r\n    \r\n    this.state = { \r\n      user: {},\r\n      isLoggedIn: false,\r\n      permissions: 0,\r\n      renderData: [],\r\n      isLoading1: true,\r\n      isLoading2: true,\r\n    };\r\n  }\r\n  \r\n  componentDidMount()\r\n  {\r\n    this.setState(() => ({ isLoading1: true , isLoading2: true}));\r\n    if (Config.prod) \r\n    { \r\n      this.checkUser();\r\n      this.setPermission();\r\n    } \r\n    else \r\n    {\r\n      // In der Testumgebung simulierter User\r\n      this.setState(() => ({user: Config.testuser, permissions: Config.testuser.permissions}));\r\n\r\n      // Re-rendering - sollte nur auf passiv genutzten Geräten (z. B. Monitor an Platz) verwendet werden\r\n      // this.interval = setInterval(()  => this.forceUpdate(), 1000)\r\n    }\r\n  }\r\n\r\n  checkUser() \r\n  {\r\n    const url = Config.protokoll + Config.hostname + \"/intern/api/checkuser.php\";\r\n    fetch(url, {credentials: 'same-origin'})\r\n    .then( (res) => {\r\n      if (res.ok) {\r\n        res.json()\r\n        .then( (user) => {\r\n          if (user.retcode === 'OK') {\r\n            this.setState(() => ({user: user.user, isLoading1: false}));\r\n          } else {\r\n            // console.log(\"App.js/Checkuser: Authentifizierungsfehler\")\r\n            window.location.href = Config.protokoll + Config.hostname + Config.loginPage;\r\n          }\r\n        });\r\n      }\r\n    })\r\n  }\r\n  \r\n  setPermission() \r\n  {\r\n    const url = Config.protokoll + Config.hostname + \"/intern/api/checkpermission.php\";\r\n    // console.log(url)\r\n    fetch(url, {credentials: 'same-origin'})\r\n    .then( (res) => {\r\n      if (res.ok) {\r\n        res.json()\r\n        .then( (permissions) => {\r\n          // console.log(permitted.retcode)\r\n          this.setState(() => ({permissions: permissions.retcode, isLoading2: false}))\r\n        })\r\n      }\r\n    })\r\n  }\r\n  \r\n  render() \r\n  {\r\n    const { isLoading1, isLoading2 } = this.state;\r\n    if (Config.prod && (isLoading1 || isLoading2)) {\r\n      return <p>Loading...</p>\r\n    } else {\r\n      return (\r\n        <React.Fragment>\r\n          <div className=\"container\">\r\n            <div className=\"row\">\r\n              <div className=\"col text-left\">\r\n                <img src=\"/images/tcoplain_0,1x.png\" alt=\"TCO -Logo\" />\r\n              </div>\r\n              <div className=\"col\">\r\n                <span className=\"h6 text-center ml-2\"><a href=\"/intern/tafel/\" id=\"appname\">Platzbuchung</a></span> \r\n                <span className=\"text-center ml-2\"><small> ({this.state.user.vorname + ' ' + this.state.user.nachname})</small></span>\r\n              </div>\r\n              <div className=\"col\">\r\n                <div className=\"small align-bottom\"><span className=\"pl-5\"><a href=\"/intern/logout.php\"><img src=\"/images/logout.png\" alt=\"Logout\" /></a></span></div> \r\n              </div>\r\n            </div>\r\n          </div>\r\n              \r\n          <Routing userId = {this.state.user.id} permissions = {this.state.permissions}/>\r\n          <footer className=\"blockquote-footer\">(c) 2019 by Conny Roloff. Dem TC Olching zur kostenlosen Nutzung zur Verfügung gestellt.</footer>\r\n        </React.Fragment>\r\n      )}\r\n    }\r\n  }\r\n\r\n\r\nexport default App;\r\n  ","import 'babel-polyfill'; \r\nimport 'react-app-polyfill/ie11';\r\nimport React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport { BrowserRouter as Router } from 'react-router-dom';\r\nimport App from './components/App';\r\n\r\nReactDOM.render((\r\n  <Router>\r\n    <App />\r\n  </Router>\r\n), document.getElementById('root'));\r\n\r\n// import index from \"./js/index\";\r\n"],"sourceRoot":""}