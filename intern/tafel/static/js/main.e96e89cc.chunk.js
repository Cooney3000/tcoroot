(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{216:function(e,t,a){e.exports=a(514)},458:function(e,t,a){},514:function(e,t,a){"use strict";a.r(t);a(217),a(419);var n,s=a(0),r=a.n(s),i=a(210),l=a.n(i),o=a(518),c=a(16),u=a(17),p=a(19),m=a(18),d=a(20),h=a(519),g=a(520),v=a(211),b=a.n(v),f=a(517),E=a(7),y=(n={testuser:{id:211,vorname:"Hart",nachname:"VerdrahtetAdm",permissions:65535}},Object(E.a)(n,"testuser",{id:357,vorname:"Hart",nachname:"VerdrahtetUsr2",permissions:432}),Object(E.a)(n,"stringSeparator"," "),Object(E.a)(n,"smartphoneWidth",578),Object(E.a)(n,"anzahlPlaetze",6),Object(E.a)(n,"platzArray",[]),Object(E.a)(n,"daypickerMaxDays",180),Object(E.a)(n,"daypickerDaysBeforeToday",3),Object(E.a)(n,"daypickerDaysBeforeTodayWide",9),Object(E.a)(n,"buchungenlog","/intern/api/buchungenlog.php"),Object(E.a)(n,"platzbuchungen","/intern/api/platz.php"),Object(E.a)(n,"dailyStartTime",8),Object(E.a)(n,"dailyEndTime",20),Object(E.a)(n,"eveningTime",1700),Object(E.a)(n,"maxMinutesDistance",15),Object(E.a)(n,"singleTime",60),Object(E.a)(n,"doubleTime",120),Object(E.a)(n,"turnierTime",120),Object(E.a)(n,"gastId",1),Object(E.a)(n,"mitgliedId",25),Object(E.a)(n,"platzLeer","\xa0\xa0"),Object(E.a)(n,"platzBelegt","\u29eb"),Object(E.a)(n,"slotMinimalMinutes",18e5),Object(E.a)(n,"delimiter","\xa7\xa7\xa7"),n);y.hostname="localhost",y.protokoll="http://",y.loginPage="/intern/login.php",y.prod=!1;for(var N="text-danger",A={gast:[N,!1,"- Bitte den Gastnamen ins Kommentarfeld schreiben und die Geb\xfchr innerhalb einer Woche \xfcberweisen!"],mitglied:[N,!1,"- Bitte nur f\xfcr Mitglieder ohne Email verwenden und den Namen ins Kommentarfeld schreiben!"],veranstaltung:[N,!0,"- Bitte den Veranstaltungsanlass ins Kommentarfeld schreiben und den Vorstand informieren!"],spieleranzahl:[N,!1,"- Bitte alle Personen eintragen!"],jugendvorrecht:["text-info",!0,"- Achtung: Jugendliche haben auf Platz 6 zu dieser Zeit Vorrecht!"],erwachsenenvorrecht:[N,!1,"- Buchung erst 15 Minuten vor Spielbeginn m\xf6glich, da erwachsene Vollmitglieder abends ab 17:00 Uhr Vorrecht haben."],einzeldauer:[N,!1,"- F\xfcr ein Einzel maximal 60 Minuten buchen"],doppeldauer:[N,!1,"- F\xfcr ein Doppel maximal 120 Minuten buchen"],turnier:["text-info",!0,"- Turnierspiele 120 Minuten. Falls m\xf6glich auf Platz 1 buchen. Parallel sollte ein Platz auf der Anlage nicht durch Turniere oder Training belegt sein! Wer Mannschaftstraining hat, darf nur auf den Pl\xe4tzen der Mannschaft Turnier spielen."],turnierspieldauer:[N,!1,"- Turnierspiele 120 Minuten. Falls m\xf6glich auf Platz 1 buchen. Parallel sollte ein Platz auf der Anlage nicht durch Turniere oder Training belegt sein! Wer Mannschaftstraining hat, darf nur auf den Pl\xe4tzen der Mannschaft Turnier spielen."],zeit:[N,!1,"- Der Start muss vor dem Ende liegen!"],platzbelegt:[N,!1,"- Platz bereits belegt!"]},k=1;k<=y.anzahlPlaetze;k++)y.platzArray.push(k);var T={NONE:0,MANNSCHAFTSFUEHRER:32,WIRT:64,T_ALL_PERMISSIONS:128,VORSTAND:496,ADMINISTRATOR:65535},w=y,z=function(e){var t=""+(e.getMonth()+1),a=""+e.getDate(),n=e.getFullYear();return t.length<2&&(t="0"+t),a.length<2&&(a="0"+a),[n,t,a].join("-")},O=function(e,t){var a=new Date;a=a.getFullYear();var n=new Date(e),s=" ("+(a-(n=n.getFullYear())<18?"Jug":"")+(1===Number(t)?",Schn":"")+")";return s=(s=s.replace("(,","(")).replace("()","")},D=function(){var e=j(document.cookie).servertime;return new Date(Number(e))},j=function(e){return e.split(";").map(function(e){return e.split("=")}).reduce(function(e,t){return e[decodeURIComponent(t[0].trim())]=decodeURIComponent(t[1].trim()),e},{})};function M(e){var t=new Date,a=new Date;t.setHours(8,0,0,0),a.setHours(21,0,0,0);for(var n=[];t<=a;t=new Date(t.getTime()+w.slotMinimalMinutes)){var s=t.toTimeString().substr(0,5);n[s]=[];for(var r=1;r<=w.anzahlPlaetze;r++)n[s].push(r)}for(var i in e)for(var l=new Date(e[i].starts_at),o=(new Date(e[i].ends_at)-l)/w.slotMinimalMinutes,c=0;c<o;c++){var u=new Date(l.getTime()+c*w.slotMinimalMinutes),p=Number(e[i].court)-1;n[u.toTimeString().substr(0,5)][p]=w.platzBelegt}return n}var S=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(p.a)(this,Object(m.a)(t).call(this,e))).handleWindowSizeChange=function(){a.setState({zumBelegungstag:!0})},a.state={courtData:[],isLoading:!1,error:!1,width:window.innerWidth,zumBelegungstag:!1},a}return Object(d.a)(t,e),Object(u.a)(t,[{key:"componentDidUpdate",value:function(e){if(this.props.day!==e.day){var t=this.props,a=t.court,n=t.day,s=t.permissions;this.fetchPlatz(a,n,s)}}},{key:"componentDidMount",value:function(){var e=this.props,t=e.court,a=e.day,n=e.permissions;this.fetchPlatz(t,a,n)}},{key:"fetchPlatz",value:function(e,t,a){var n=this,s=(T.MANNSCHAFTSFUEHRER&a)>0,i=w.protokoll+w.hostname+"/intern/api/platz.php?op=ra&p="+e+"&ds="+t+"&de="+t;window.addEventListener("resize",this.handleWindowSizeChange),this.setState({isLoading:!0}),fetch(i,{credentials:"same-origin"}).then(function(e){if(e.ok)return e.redirected&&(window.location.href=e.url),e.json();n.setState({isLoading:!1})}).then(function(a){var i=a.records.map(function(a){var i,l=a.id,o=x(a.starts_at,a.ends_at,a.booking_type);return i=C(a,n.props.platzWide),!s&&a.booking_type.match(/(ts-training)|(ts-punktspiele)|(ts-nichtreservierbar)|(ts-veranstaltung)/gi)?r.a.createElement("div",{key:l,className:o},r.a.createElement("strong",null,a.starts_at.substring(11,16))," ",i,r.a.createElement("div",null," ",a.comment," ")):r.a.createElement(f.a,{key:l,className:o,to:{pathname:"/intern/tafel/belegung",state:{c:e,i:a.id,d:t,op:"update"}}},r.a.createElement("strong",null,a.starts_at.substring(11,16))," ",i,r.a.createElement("div",null," ",a.comment," "))});n.setState({courtData:i}),n.setState({isLoading:!1})})}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleWindowSizeChange)}},{key:"render",value:function(){return this.state.courtData}}]),t}(s.Component),C=function(e,t){var a=[];return a[0]=(e.p1vn?(t?e.p1vn:e.p1vn.charAt(0)+".")+" "+e.p1nn:e.p1nn?e.p1nn:"")+O(e.p1geb,e.schnupper1),a[1]=(e.p2vn?(t?e.p2vn:e.p2vn.charAt(0)+".")+" "+e.p2nn:e.p2nn?e.p2nn:"")+O(e.p2geb,e.schnupper2),a[2]=(e.p3vn?(t?e.p3vn:e.p3vn.charAt(0)+".")+" "+e.p3nn:e.p3nn?e.p3nn:"")+O(e.p3geb,e.schnupper3),a[3]=(e.p4vn?(t?e.p4vn:e.p4vn.charAt(0)+".")+" "+e.p4nn:e.p4nn?e.p4nn:"")+O(e.p4geb,e.schnupper4),a=(a=(a=a.map(function(e){return e.replace(new RegExp(/^[\.\s]+/g),"")})).join(", ")).replace(new RegExp(/[,\s]*$/g),"")},x=function(e,t,a){var n=60*Number(t.substring(11,13))+Number(t.substring(14,16))-(60*Number(e.substring(11,13))+Number(e.substring(14,16))),s=a;return b()("D-"+n,"ts","T-"+e.substring(11,16).replace(":","-"),s)},B=S,L=a(212),F=a.n(L),I=[],R=function(e){var t=e.text,a=e.selected;return r.a.createElement("div",{className:"dateBtn ".concat(a?"aktiv":"")},t)},P=function(e){var t=e.text;e.className;return r.a.createElement("div",{className:"dateBtn arrowPicker"},t)},H=P({text:"<",className:"arrow-prev"}),W=P({text:">",className:"arrow-next"}),V=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(p.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(s)))).state={selected:0},a.onSelect=function(e){a.setState({selected:e},function(){return a.props.onClickHandler(e)})},a}return Object(d.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){var e=this.props,t=e.startswith,a=e.day,n=new Date(a);n.setDate(n.getDate()+w.daypickerMaxDays),I=function(e,t){for(var a=new Date(e),n=[];a<=t;)n.push({name:z(a),text:a.toLocaleDateString("de-DE",{weekday:"short",month:"short",day:"numeric"})}),a.setDate(a.getDate()+1);return n}(t,n),this.setState({selected:a})}},{key:"render",value:function(){var e=this.state.selected,t=I.map(function(e){var t=e.name,a=e.text;return r.a.createElement(R,{text:a,key:t})});return r.a.createElement("div",{className:"App"},r.a.createElement(F.a,{data:t,arrowLeft:H,arrowRight:W,selected:e,onSelect:this.onSelect}))}}]),t}(s.Component),_=(a(458),a(213)),U=a.n(_),Y=function(e){function t(){var e;return Object(c.a)(this,t),(e=Object(p.a)(this,Object(m.a)(t).call(this))).handleWindowSizeChange=function(){e.setState({width:window.innerWidth})},e.state={width:window.innerWidth,day:"",dayDate:""},e}return Object(d.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){window.addEventListener("resize",this.handleWindowSizeChange);var e,t=this.props.match.params.day;t=(e=new Date(t))instanceof Date&&!isNaN(e)?new Date(t):new Date,this.setState({dayDate:t,day:z(t)}),this.setDay=this.setDay.bind(this)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleWindowSizeChange)}},{key:"setDay",value:function(e){var t=new Date(e);this.setState({dayDate:t,day:z(t)})}},{key:"render",value:function(){var e=this,t=this.state.width,a=new Date;if(t<=w.smartphoneWidth){a.setDate(a.getDate()-w.daypickerDaysBeforeToday);var n=w.platzArray.map(function(t){return r.a.createElement("div",{key:t,id:"platz"+t},r.a.createElement("table",{className:"table"},r.a.createElement("tbody",null,r.a.createElement("tr",{className:"platzDim"},r.a.createElement("td",{className:"zeitleisteCol"},r.a.createElement(G,null)),r.a.createElement("td",{className:"platz"},r.a.createElement("div",{className:"platznummer"},r.a.createElement("span",{className:"platzziffer"},t),r.a.createElement(f.a,{to:{pathname:"/intern/tafel/belegung",state:{c:t,d:e.state.day,op:"new"}}},r.a.createElement("img",{className:"neuBtn p-1 rounded-circle",src:"images/add.png",alt:"Neue Belegung"}))),r.a.createElement("div",null,r.a.createElement(B,{court:t,day:e.state.day,permissions:e.props.permissions,platzWide:!0})))))))});return r.a.createElement("div",null,r.a.createElement(V,{startswith:a,day:this.state.day,onClickHandler:this.setDay}),r.a.createElement(U.a,null,n),r.a.createElement(J,null))}a.setDate(a.getDate()-w.daypickerDaysBeforeTodayWide);var s=w.platzArray.map(function(t){return r.a.createElement("td",{key:t,id:"platz"+t,className:"platz"},r.a.createElement("div",null,r.a.createElement("div",{className:"platznummer"},r.a.createElement("span",{className:"platzziffer rounded-circle"},t),r.a.createElement(f.a,{to:{pathname:"/intern/tafel/belegung",state:{c:t,d:e.state.day,op:"new"}}},r.a.createElement("img",{className:"neuBtn p-1 rounded-circle",src:"images/add.png",alt:"Neue Belegung"}))),r.a.createElement("div",null,r.a.createElement(B,{court:t,day:e.state.day,permissions:e.props.permissions,platzWide:!1}))))});return r.a.createElement("div",null,r.a.createElement(V,{startswith:a,day:this.state.day,onClickHandler:this.setDay}),r.a.createElement("table",{className:"table"},r.a.createElement("tbody",null,r.a.createElement("tr",{className:"platzDim"},r.a.createElement("td",{className:"zeitleisteCol"},r.a.createElement(G,null)," "),s))),r.a.createElement(J,null))}}]),t}(s.Component),G=function(){for(var e=[],t=w.dailyStartTime;t<=w.dailyEndTime;t++)for(var a=0;a<60;a+=60)e.push(t.toString().padStart(2,"0")+":"+a.toString().padStart(2,"0"));return r.a.createElement("div",{className:"zeitleiste"},e.map(function(e,t){return r.a.createElement(r.a.Fragment,{key:t},r.a.createElement("div",{className:"stunde"},r.a.createElement("div",{className:"stundetext"},e)),r.a.createElement("div",{className:"viertelstunde"}),r.a.createElement("div",{className:"viertelstunde"}),r.a.createElement("div",{className:"viertelstunde"}))}))},J=function(){return r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"row l-einzeldoppel p-0 pl-1 m-1"},"Einzel/Doppel"),r.a.createElement("div",{className:"row l-turnier p-0 pl-1 m-1"},"Turnier"),r.a.createElement("div",{className:"row l-veranstaltung p-0 pl-1 m-1"},"Veranstaltung"),r.a.createElement("div",{className:"row l-punktspiele p-0 pl-1 m-1"},"Punktspiele"),r.a.createElement("div",{className:"row l-training p-0 pl-1 m-1"},"Training"))},Z=Y,K=a(14),q=a(43),$=a(521),Q=a(214),X=a.n(Q),ee=a(215),te=a.n(ee),ae=function(e){function t(e){var a;Object(c.a)(this,t),(a=Object(p.a)(this,Object(m.a)(t).call(this,e))).handleChange=a.handleChange.bind(Object(q.a)(Object(q.a)(a))),a.handleSave=a.handleSave.bind(Object(q.a)(Object(q.a)(a))),a.handleDelete=a.handleDelete.bind(Object(q.a)(Object(q.a)(a)));var n=e.r,s=n.starts_at.split(" "),r=Object(K.a)(s,2),i=r[0],l=r[1],o=new Date(i),u=D();o.setHours(0,0,0,0),u.setHours(0,0,0,0);var d=o.valueOf()===u.valueOf(),h=""===n.booking_type?d?"ts-einzel":"ts-turnier":n.booking_type,g=[Number([n.p1id]),Number([n.p2id]),Number([n.p3id]),Number([n.p4id])].includes(Number(a.props.userId))||T.VORSTAND===(T.VORSTAND&a.props.permissions),v=n.ends_at.split(" "),b=Object(K.a)(v,2),f=b[0],E=b[1],y=i.split("-");return a.state={r:n,spieltag:y[2]+"."+y[1]+"."+y[0],startsAtDate:i,endsAtDate:f,startsAt:l.substring(0,5),endsAt:E.substring(0,5),bookingType:h,comment:"undefined"===typeof n.comment?"":n.comment,p1:0===n.p1id?Number(a.props.userId):Number(n.p1id),p2:Number(n.p2id),p3:Number(n.p3id),p4:Number(n.p4id),p1Schn:n.schnupper1,p2Schn:n.schnupper2,p3Schn:n.schnupper3,p4Schn:n.schnupper4,spieler:[],belegungenAbJetzt:[],court:"undefined"===typeof n.court?"--":n.court,zurTafel:!1,saveActive:!1,deleteActive:g,endeActive:!1,admin:!1,dateIsToday:d,overbooked:!1,jugend:!1,nichtVollBerechtigte:!1,timetable:[],isLoading1:!0,isLoading2:!0,courtBelegt:[]},a}return Object(d.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=w.protokoll+w.hostname+"/intern/api/spieler.php";this.setState({isLoading1:!0}),fetch(t,{credentials:"same-origin"}).then(function(e){if(e.ok)return e.json();throw new Error("Fehler beim Laden der Spielerdaten")}).then(function(t){var a=t.records;e.setState({spieler:a,isLoading1:!1})}).catch(function(t){return e.setState({error:t,isLoading1:!1})}),t=w.protokoll+w.hostname+"/intern/api/belegungenabjetzt.php",this.setState({isLoading2:!0}),fetch(t,{credentials:"same-origin"}).then(function(e){if(e.ok)return e.json();throw new Error("Fehler beim Laden der Belegungsdaten")}).then(function(t){e.setState({timetable:M(t.records),isLoading2:!1})}).catch(function(t){return e.setState({error:t,isLoading2:!1})})}},{key:"render",value:function(){var e=this,t=this.state,a=t.isLoading1,n=t.isLoading2;if(a||n)return r.a.createElement("p",null,"Loading...");if(!0===this.state.zurTafel)return r.a.createElement($.a,{to:{pathname:"/intern/tafel/",state:this.state.startsAtDate}});var s=T.MANNSCHAFTSFUEHRER===(T.MANNSCHAFTSFUEHRER&this.props.permissions);return r.a.createElement("div",null,r.a.createElement("h1",null,"Spieltag: ",this.state.spieltag),r.a.createElement("form",{className:"form-inline"},r.a.createElement("fieldset",{className:"fields"},r.a.createElement("div",null,r.a.createElement("strong",null,"Buchungstyp")),!this.state.dateIsToday&&r.a.createElement("div",null,"Einzel-/Doppel-Buchung nur am aktuellen Tag m\xf6glich"),r.a.createElement("select",{id:"bookingType",className:"form-control",onChange:this.handleChange,value:this.state.bookingType},r.a.createElement("option",{disabled:!this.state.dateIsToday,value:"ts-einzel"},"Einzel"),r.a.createElement("option",{disabled:!this.state.dateIsToday,value:"ts-doppel"},"Doppel"),r.a.createElement("option",{value:"ts-turnier"},"Turnier"),r.a.createElement("option",{disabled:!s,value:"ts-veranstaltung"},"Veranstaltung"),r.a.createElement("option",{disabled:!s,value:"ts-training"},"Training"),r.a.createElement("option",{disabled:!s,value:"ts-punktspiele"},"Punktspiele")),r.a.createElement("div",null,r.a.createElement("strong",null,"Start")," ",r.a.createElement("span",{id:"startsAtMsg",className:this.state.startsAtMsgClass},this.state.startsAtMsgTxt)),r.a.createElement("div",{className:"form-group"},r.a.createElement("div",null,r.a.createElement("select",{id:"startsAt",className:"form-control "+this.state.startsAtMsgClass,onChange:this.handleChange,value:this.state.startsAt},Object.keys(this.state.timetable).map(function(t){return r.a.createElement("option",{key:t,value:t},t,"h \xa0 ",e.state.timetable[t][0],"\xa0 ",e.state.timetable[t][1],"\xa0 ",e.state.timetable[t][2],"\xa0 ",e.state.timetable[t][3],"\xa0 ",e.state.timetable[t][4],"\xa0 ",e.state.timetable[t][5])})))),r.a.createElement("div",null,r.a.createElement("strong",null,"Platz")),r.a.createElement("div",{className:"form-group"},r.a.createElement("select",{id:"court",className:"form-control",onChange:this.handleChange,value:this.state.court},r.a.createElement("option",{value:"--"},"--"),r.a.createElement("option",{disabled:this.state.courtBelegt[0],value:"1"},"1"),r.a.createElement("option",{disabled:this.state.courtBelegt[1],value:"2"},"2"),r.a.createElement("option",{disabled:this.state.courtBelegt[2],value:"3"},"3"),r.a.createElement("option",{disabled:this.state.courtBelegt[3],value:"4"},"4"),r.a.createElement("option",{disabled:this.state.courtBelegt[4],value:"5"},"5"),r.a.createElement("option",{disabled:this.state.courtBelegt[5],value:"6"},"6"))),r.a.createElement("div",null,r.a.createElement("strong",null,"Ende")),r.a.createElement("div",{className:"form-group"},r.a.createElement("div",null,r.a.createElement("select",{id:"endsAt",className:"form-control "+this.state.startsAtMsgClass,onChange:this.handleChange,value:this.state.endsAt},Object.keys(this.state.timetable).map(function(t){return r.a.createElement("option",{disabled:!e.state.endeActive,key:t,value:t},t,"h")})))),r.a.createElement("div",null,r.a.createElement("strong",null,this.state.bookingType.match(/(ts-einzel)|(ts-doppel)|(ts-turnier)/gi)?"Spieler":"Verantwortlicher")," ",r.a.createElement("span",{id:"p1Msg",className:this.state.p1MsgClass},this.state.p1MsgTxt)),r.a.createElement("div",{className:"form-row"},r.a.createElement("select",{id:"p1",className:"form-control "+this.state.p1MsgFormCtrl,onChange:this.handleChange,value:this.state.p1},r.a.createElement("option",{value:"0"},"- Bitte ausw\xe4hlen -"),this.state.spieler.map(function(e){return r.a.createElement("option",{key:"p1"+e.id,value:e.id},e.spieler+O(e.geburtsdatum,e.schnupper))})),this.state.bookingType.match(/(ts-einzel)|(ts-turnier)|(ts-doppel)/gi)?r.a.createElement("select",{id:"p2",className:"form-control "+this.state.p1MsgFormCtrl,onChange:this.handleChange,value:this.state.p2},r.a.createElement("option",{value:"0"},"- Bitte ausw\xe4hlen -"),this.state.spieler.map(function(e){return r.a.createElement("option",{key:"p2"+e.id,value:e.id},e.spieler+O(e.geburtsdatum,e.schnupper))})):""),r.a.createElement("div",{className:"form-row"},"ts-doppel"===this.state.bookingType?r.a.createElement("select",{id:"p3",className:"form-control "+this.state.p1MsgFormCtrl,onChange:this.handleChange,value:this.state.p3},r.a.createElement("option",{value:"0"},"- Bitte ausw\xe4hlen -"),this.state.spieler.map(function(e){return r.a.createElement("option",{key:"p3"+e.id,value:e.id},e.spieler+O(e.geburtsdatum,e.schnupper))})):"","ts-doppel"===this.state.bookingType?r.a.createElement("select",{id:"p4",className:"form-control "+this.state.p1MsgFormCtrl,onChange:this.handleChange,value:this.state.p4},r.a.createElement("option",{value:"0"},"- Bitte ausw\xe4hlen -"),this.state.spieler.map(function(e){return r.a.createElement("option",{key:"p4"+e.id,value:e.id},e.spieler+O(e.geburtsdatum,e.schnupper))})):""),r.a.createElement("div",null,r.a.createElement("strong",null,"Bemerkung")," ",r.a.createElement("span",{id:"commentMsg",className:this.state.commentMsgClass},this.state.commentMsgTxt)),r.a.createElement("div",{className:"form-group"},r.a.createElement("input",{type:"text",id:"comment",className:"form-control w-100 "+this.state.p1MsgFormCtrl,onChange:this.handleChange,value:this.state.comment,placeholder:"Spielergebnis, Gastname, ..."})),r.a.createElement("button",{type:"submit",onClick:function(t){e.handleSave(t)},className:"btn btn-primary m-1",disabled:!this.state.saveActive},"Speichern"),r.a.createElement("button",{type:"submit",onClick:function(t){e.handleDelete(t)},className:"btn btn-primary m-2",disabled:!this.state.deleteActive},"L\xf6schen"))))}},{key:"handleSave",value:function(e){var t=this;e.preventDefault();var a={startsAtMsgTxt:"",startsAtMsgClass:"",saveActive:!0,p1MsgFormCtrl:""},n="?op=cu&rid="+this.state.r.id+"&ds="+this.state.startsAtDate+" "+this.state.startsAt+"&de="+this.state.endsAtDate+" "+this.state.endsAt+"&uid="+this.props.userId+"&p1="+this.state.p1+"&p2="+this.state.p2+"&p3="+this.state.p3+"&p4="+this.state.p4+"&c="+this.state.court+"&t="+this.state.bookingType+"&cmt="+this.state.comment+"&pr=0",s=w.protokoll+w.hostname+"/intern/api/platz.php"+n;fetch(s,{credentials:"same-origin"}).then(function(e){if(e.ok)return e.json();throw new Error("Fehler beim Erzeugen/Updaten der Belegung"+t.state.r.id)}).then(function(e){var s=e.records[0].returncode;if("ok"===s){var r=w.protokoll+w.hostname+w.buchungenlog+n;fetch(r,{credentials:"same-origin"}),t.setState({zurTafel:!0})}else if("bereits belegt"===s){var i=Object(K.a)(A.platzbelegt,3);a.startsAtMsgClass=i[0],a.saveActive=i[1],a.startsAtMsgTxt=i[2]}else window.location.href=w.loginPage;t.setState(a)})}},{key:"handleDelete",value:function(e){var t=this,a=this.state.startsAtDate+"T"+this.state.startsAt+"Z",n=new Date(a),s=new Date;if(e.preventDefault(),n>=s||T.VORSTAND&this.props.permissions){var r="?op=d&rid="+this.state.r.id+"&uid="+this.props.userId,i=w.protokoll+w.hostname+w.platzbuchungen+r;fetch(i,{credentials:"same-origin"}).then(function(e){if(e.ok){var a=w.protokoll+w.hostname+w.buchungenlog+r;fetch(a,{credentials:"same-origin"}),t.setState({zurTafel:!0})}})}else this.setState({zurTafel:!0});e.preventDefault()}},{key:"handleChange",value:function(e){var t=this;e.preventDefault(),this.setState(Object(E.a)({},e.target.id,e.target.value),function(){var e={p1MsgTxt:"",p1MsgClass:"",startsAtMsgTxt:"",startsAtMsgClass:"",commentMsgTxt:"",commentMsgClass:"",saveActive:!0,deleteActive:!0,endeActive:!1,p1MsgFormCtrl:"",overbooked:!1};e.startsAt=t.state.startsAt,e.timetable=t.state.timetable,e.courtBelegt=e.timetable[e.startsAt].map(function(e){return e===w.platzBelegt});var a=t.state.startsAt.substring(3,5),n=t.state.endsAt.substring(0,2);"ts-einzel"===t.state.bookingType?n=(Number(t.state.startsAt.substring(0,2))+1).toLocaleString("de-DE",{minimumIntegerDigits:2,useGrouping:!1}):t.state.bookingType.match(/(ts-turnier)|(ts-doppel)/gi)&&(n=(Number(t.state.startsAt.substring(0,2))+2).toLocaleString("de-DE",{minimumIntegerDigits:2,useGrouping:!1})),e.endsAt=n+":"+a;var s=!1,r=!1,i=!1,l=!1,o=!1,c=t.state.startsAtDate+"T"+t.state.startsAt+"Z",u=new Date(c),p=new te.a;p.init("DE","BY");var m=!!p.isHoliday(u)||0===u.getDay()||6===u.getDay(),d=60*Number(e.startsAt.substring(0,2))+Number(e.startsAt.substring(3,5)),h=60*Number(e.endsAt.substring(0,2))+Number(e.endsAt.substring(3,5)),g=[Number(t.state.p1),Number(t.state.p2),Number(t.state.p3),Number(t.state.p4)];g.forEach(function(e){null!=e&&(e===Number(t.props.userId)&&(o=!0),e===w.gastId&&(s=!0),e===w.mitgliedId&&(r=!0))}),o=o||t.props.userId===t.state.r.user_id,g.map(function(e){if(null!=e)return"0"!==(function(e){if("undefined"===typeof e||null===e)return!1;var t=new Date;t=t.getFullYear();var a=new Date(e);return t-(a=a.getFullYear())<18}(e.geburtsdatum)||e.schnupper)&&(i=!0),e.geburtsdatum});var v=!0;if(t.state.bookingType.match(/(ts-veranstaltung)|(ts-training)|(ts-nichtreservierbar)/gi)){if(0===Number(t.state.p1)){var b=Object(K.a)(A.spieleranzahl,3);e.p1msgClass=b[0],e.saveActive=b[1],e.p1MsgTxt=b[2],e.p1MsgFormCtrl="is-invalid"}e.p2=e.p3=e.p4=0}if(v=!0===v&&e.saveActive,t.state.bookingType.match(/(ts-turnier)|(ts-einzel)/gi)){if(0===Number(t.state.p1)||0===Number(t.state.p2)){var f=Object(K.a)(A.spieleranzahl,3);e.p1msgClass=f[0],e.saveActive=f[1],e.p1MsgTxt=f[2],e.p1MsgFormCtrl="is-invalid"}else if(t.state.p1===t.state.p2){l=!0;var E=Object(K.a)(A.spieleranzahl,3);e.p1msgClass=E[0],e.saveActive=E[1],e.p1MsgTxt=E[2],e.p1MsgFormCtrl="is-invalid"}e.p3=e.p4=0}if(v=!0===v&&e.saveActive,"ts-doppel"===t.state.bookingType&&(l=X.a.uniq([t.state.p1,t.state.p2,t.state.p3,t.state.p4]).length<4,!s&&(l||0===Number(t.state.p3)||0===Number(t.state.p4)))){var y=Object(K.a)(A.spieleranzahl,3);e.p1MsgClass=y[0],e.saveActive=y[1],e.p1MsgTxt=y[2],e.p1MsgFormCtrl="is-invalid"}if(v=!0===v&&e.saveActive,s||r)if(t.state.bookingType.match(/(ts-einzel)|(ts-doppel)/gi)){if(t.state.comment.length<2){var N=s?A.gast:A.mitglied,k=Object(K.a)(N,3);e.commentMsgClass=k[0],e.saveActive=k[1],e.commentMsgTxt=k[2],e.p1MsgFormCtrl="is-invalid"}}else{var z=Object(K.a)(A.spieleranzahl,3);e.p1MsgClass=z[0],e.saveActive=z[1],e.p1MsgTxt=z[2],e.p1MsgFormCtrl="is-invalid"}if("ts-veranstaltung"===t.state.bookingType){var O=Object(K.a)(A.veranstaltung,3);e.commentMsgClass=O[0],e.saveActive=O[1],e.commentMsgTxt=O[2]}if(v=!0===v&&e.saveActive,t.state.bookingType.match(/(ts-einzel)|(ts-doppel)/gi)){var D=new Date;if(d-(60*D.getHours()+D.getMinutes())>w.maxMinutesDistance&&!i&&!m&&h>w.eveningTime/100*60){var j=Object(K.a)(A.erwachsenenvorrecht,3);e.startsAtMsgClass=j[0],e.saveActive=j[1],e.startsAtMsgTxt=j[2],e.overbooked=!0}}if(v=!0===v&&e.saveActive,d>=h){var M=Object(K.a)(A.zeit,3);e.startsAtMsgClass=M[0],e.saveActive=M[1],e.startsAtMsgTxt=M[2]}else if("ts-einzel"===t.state.bookingType){if(h-d>w.singleTime){var S=Object(K.a)(A.einzeldauer,3);e.startsAtMsgClass=S[0],e.saveActive=S[1],e.startsAtMsgTxt=S[2]}}else if("ts-doppel"===t.state.bookingType){if(h-d>w.doubleTime){var C=Object(K.a)(A.doppeldauer,3);e.startsAtMsgClass=C[0],e.saveActive=C[1],e.startsAtMsgTxt=C[2]}}else if("ts-turnier"===t.state.bookingType)if(h-d!==w.turnierTime){var x=Object(K.a)(A.turnierspieldauer,3);e.startsAtMsgClass=x[0],e.saveActive=x[1],e.startsAtMsgTxt=x[2]}else{var B=Object(K.a)(A.turnier,3);e.startsAtMsgClass=B[0],e.saveActive=B[1],e.startsAtMsgTxt=B[2]}v=!0===v&&e.saveActive,t.state.bookingType.match(/(ts-einzel)|(ts-doppel)|(ts-turnier)/gi)&&(e.saveActive=o||T.VORSTAND===(T.VORSTAND&t.props.permissions),e.deleteActive=o||T.VORSTAND===(T.VORSTAND&t.props.permissions),e.endeActive=!1),t.state.bookingType.match(/(ts-training)|(ts-punktspiele)|(ts-nichtreservierbar)|(ts-veranstaltung)/gi)&&(e.saveActive=T.MANNSCHAFTSFUEHRER===(T.MANNSCHAFTSFUEHRER&t.props.permissions),e.endeActive=!0),t.state.bookingType.match(/(ts-training)|(ts-punktspiele)|(ts-nichtreservierbar)|(ts-veranstaltung)/gi)&&(e.deleteActive=T.MANNSCHAFTSFUEHRER===(T.MANNSCHAFTSFUEHRER&t.props.permissions)),v=!0===v&&e.saveActive,e.saveActive=v,t.setState(e)})}}]),t}(s.Component);var ne=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(p.a)(this,Object(m.a)(t).call(this,e))).state={belegung:[],isLoading:!1,error:!1},a}return Object(d.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){var e=this.props.location.state.op;if("update"===e){var t=this.props.location.state,a=t.i,n=t.d;this.updateBel(a,n)}else if("new"===e){var s=this.props.location.state,r=s.c,i=s.d;this.newBel(r,i)}}},{key:"updateBel",value:function(e,t){var a=this,n=w.protokoll+w.hostname+"/intern/api/platz.php?op=r&rid="+e;this.setState({isLoading:!0}),fetch(n,{credentials:"same-origin"}).then(function(e){if(e.ok)return e.redirected&&(console.log("BelDetails.js/Checkuser: Authentifizierungsfehler"),window.location.href=e.url),e.json();throw new Error("Fehler beim Laden der Platzbuchungsdetails")}).then(function(e){var n=e.records.map(function(e){return r.a.createElement("div",{key:e.id,className:"p-2"},r.a.createElement(f.a,{to:{pathname:"/intern/tafel/",state:{d:t}}},r.a.createElement("p",{className:"btn btn-secondary"},"Zur\xfcck")),r.a.createElement(ae,{r:e,userId:a.props.userId,permissions:a.props.permissions}))});a.setState({belegung:n})}).catch(function(e){return a.setState({error:e,isLoading:!1})})}},{key:"newBel",value:function(e,t){var a=function(e,t){return{id:0,user_id:0,p1:"",p2:"",p3:"",p4:"",court:e,starts_at:t+" 08:00:00",ends_at:t+" 09:00:00",booking_type:"",geburtsdatum:"0000-00-00",p1id:0,p2id:0,p3id:0,p4id:0}}(e,t),n=[r.a.createElement("div",{key:-1,className:"p-2"},r.a.createElement(f.a,{to:{pathname:"/intern/tafel/",state:{d:t}}},r.a.createElement("p",{className:"btn btn-secondary"},"Zur\xfcck")),r.a.createElement(ae,{r:a,userId:this.props.userId,permissions:this.props.permissions}))];this.setState({belegung:n})}},{key:"render",value:function(){return r.a.createElement("div",null,this.state.belegung)}}]),t}(s.Component),se=function(e){function t(){return Object(c.a)(this,t),Object(p.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement(h.a,null,r.a.createElement(g.a,{exact:!0,path:"/intern/tafel/belegung",render:function(t){return r.a.createElement(ne,Object.assign({},t,{userId:e.props.userId,permissions:e.props.permissions}))}}),r.a.createElement(g.a,{render:function(t){return r.a.createElement(Z,Object.assign({},t,{userId:e.props.userId,permissions:e.props.permissions}))}}))}}]),t}(s.Component),re=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(p.a)(this,Object(m.a)(t).call(this,e))).state={user:{},isLoggedIn:!1,permissions:0,renderData:[],isLoading1:!0,isLoading2:!0},a}return Object(d.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.setState(function(){return{isLoading1:!0,isLoading2:!0}}),w.prod?(this.checkUser(),this.setPermission()):this.setState(function(){return{user:w.testuser,permissions:w.testuser.permissions}})}},{key:"checkUser",value:function(){var e=this,t=w.protokoll+w.hostname+"/intern/api/checkuser.php";fetch(t,{credentials:"same-origin"}).then(function(t){t.ok&&t.json().then(function(t){"OK"===t.retcode?e.setState(function(){return{user:t.user,isLoading1:!1}}):window.location.href=w.protokoll+w.hostname+w.loginPage})})}},{key:"setPermission",value:function(){var e=this,t=w.protokoll+w.hostname+"/intern/api/checkpermission.php";fetch(t,{credentials:"same-origin"}).then(function(t){t.ok&&t.json().then(function(t){e.setState(function(){return{permissions:t.retcode,isLoading2:!1}})})})}},{key:"render",value:function(){var e=this.state,t=e.isLoading1,a=e.isLoading2;return w.prod&&(t||a)?r.a.createElement("p",null,"Loading..."):r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col text-left"},r.a.createElement("img",{src:"/images/tcoplain_0,1x.png",alt:"TCO -Logo"})),r.a.createElement("div",{className:"col"},r.a.createElement("span",{className:"h6 text-center ml-2"},r.a.createElement("a",{href:"/intern/tafel/",id:"appname"},"Platzbuchung")),r.a.createElement("span",{className:"text-center ml-2"},r.a.createElement("small",null," (",this.state.user.vorname+" "+this.state.user.nachname,")"))),r.a.createElement("div",{className:"col"},r.a.createElement("div",{className:"small align-bottom"},r.a.createElement("span",{className:"pl-5"},r.a.createElement("a",{href:"/intern/logout.php"},r.a.createElement("img",{src:"/images/logout.png",alt:"Logout"}))))))),r.a.createElement(se,{userId:this.state.user.id,permissions:this.state.permissions}),r.a.createElement("footer",{className:"blockquote-footer"},"(c) 2019 by Conny Roloff. Dem TC Olching zur kostenlosen Nutzung zur Verf\xfcgung gestellt."))}}]),t}(s.Component);l.a.render(r.a.createElement(o.a,null,r.a.createElement(re,null)),document.getElementById("root"))}},[[216,2,1]]]);
//# sourceMappingURL=main.e96e89cc.chunk.js.map