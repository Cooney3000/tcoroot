<?php
//
// Registrierungscode erzeugen und zurückgeben
// --------------------------------------------
//C:\xampp\htdocs\intern\api\regcodenew.php

require_once("../inc/config.inc.php");
require_once("../inc/functions.inc.php");
require_once("../inc/permissioncheck.inc.php");
session_start();

//Überprüfe, dass der User eingeloggt und berechtigt ist
//Der Aufruf von check_user_silent() muss in alle API-Skripten eingebaut sein
$user = check_user_silent();
if (!$user) {
  echo ('{"records": [{"returncode":"user not logged in"}] }');
  exit;
}

$userId = $user['id'];

// Create connection
global $conn;
$conn = new mysqli($db_host, $db_user, $db_password, $db_name);
$conn->set_charset("utf8");
if ($conn->connect_error) {
  die($fehlerMsg['dbconnect'] . "\r\n$db_host, $db_user, $db_password, $db_name\r\n" . ' ' . $fehlerAction . "\r\n<br>" . $conn->connect_error);
}
$person = $_GET['p'];
$json = '{"records":[]}';
$sql = '';
$result = [];

$regcodeArray = fillRegcodes();

$result = createUpdateRegCode($person);

echo json_encode($result, JSON_UNESCAPED_UNICODE|JSON_UNESCAPED_SLASHES);

$conn->close();
return;
//END



function createUpdateRegCode($person)
{
  global $conn;
  global $regcodeArray;
  $ok = FALSE;

  while ($ok != TRUE) {
    $ok = TRUE;
    $randomRegcode = $regcodeArray[rand(0, count($regcodeArray) - 1)];
    $sql = <<<EOT
INSERT INTO reg_codes 
  (regcode, person) 
  VALUES
  ('{$randomRegcode}', '{$person}')
EOT;
    // Bei Fehler nochmal!
    $ok = $conn->query($sql);
  }
  $result = [];
  $result['retcode'] = 'OK';
  $result['regcode'] = $randomRegcode;
  return $result;
}

function fillRegcodes()
{
  $arc = <<<EOF
M25GLICH W23HREND K25NNTEN ERKL23RT DAR27BER M27NCHEN W23HREND N23MLICH SCH27LER L23NDERN K27NFTIG GEW23HLT GEH25REN M23DCHEN N23CHSTE F27HRUNG GR2527TE GEB23UDE ERZ23HLT M27SSTEN GEF27HRT GR27NDEN STRA27EN ST23RKER T23GLICH FU27BALL 23HNLICH 27BERALL FR27HERE K23MPFEN M23NNERN GET25TET BR27SSEL GEL23NDE DAR27BER GM27NDER D27RFTEN ST23NDIG ST23DTEN SCHL23GT BETR23GT SCH25NEN M25CHTEN 27BRIGEN M27NSTER GR2527ER ERF27LLT B27RGERN GEPR23GT ERH25HEN KAPIT23N BEH25RDE F27NFTEN K27MMERN ERW23HNT H25CHSTE 23U27ERN PR27FUNG ERG23NZT GEH25RTE GEKL23RT W27NSCHT H23NDLER GEF23LLT SCH25NER SCH23DEN F27HRTEN VERF27GT F25RDERN J27NGSTE DRAU27EN GEPR27FT B27NDNIS Z27RCHER ERH25HTE L23NGERE ST27RMER H25HEREN KR23FTIG K27MMERT ENTH23LT ST23RKEN W27NSCHE UNGL27CK 23LTEREN R27CKZUG ANTR23GE GEF27HLE 27GYPTEN H23USERN SCH23TZT 27BRIGEN K25NIGIN W27NSCHE ZUH25RER F25RDERT GEW23HRT G27NSTIG PR23SENT 27HNLICH RU27LAND UNF23LLE K27NFTIG ERF23HRT FLIE27EN ST27RZTE 23U27ERT GENIE27T K27NDIGT L25SCHEN 27BERAUS G27NTHER W23HRUNG DR27CKEN GR25SSTE FL23CHEN GR27NDER K23MPFER PL23TZEN PR23SENZ ST23RKEN T25CHTER GEF27HLT GEZ23HLT N25TIGEN VERLIE27 SCH23FER GR27NDEN K23RNTEN L23CHELN 23LTESTE SCH25NES ANS23TZE HAUST27R MILIT23R AUS27BEN GEW25HNT T25DLICH B27CHERN G23RTNER SCH27SSE BEM27HEN BER27HRT FLEI27IG GER23UMT HIERF27R J27NGERE POPUL23R TR23UMEN UNN25TIG 27FFNUNG BR27CKEN KR23FTEN KR23UTER M23RCHEN TRIB27NE UMS23TZE BEL23UFT M23CHTIG PR23ZISE 25FFNETE GEM23LDE LEKT27RE MAN25VER M23RKTEN W23HLERN DR27CKTE M2727TEN SCH27TZT ST27NDEN S27DLICH Z23HLTEN 23LTERER D27RENER ERTR23GE F27NFTEL K27RZUNG M27TTERN P23CHTER R27DIGER VORSTO27 DR23NGEN GEST25RT SP23TERE 27BERALL D25NHOFF KL23RUNG KOM25DIE KR25NUNG ST27CKEN VERSTO27 Z23HLERN F27RCHTE GEF27LLT GEN27GEN ST27RZEN ST27TZEN T23TIGEN VERH23LT 25STLICH ANW23LTE EINFLU27 GEM27TER HIERF27R K25RPERS M25DLING SPR27CHE ST23NDEN BEW23HRT GEH25RIG GEK27RZT GER27CKT GL23NZEN GR25SSER GR27NDET W23HLTEN 27BERGAB BU27GELD GEI27LER KL27PFEL K23MPFEN M25GLICH SCHEI27E W23LDERN ABL23UFT K23MPFTE SCHIE27T SCHL23FT 27BERSAH BONIT23T FR27CHTE GR2527EN K27HLUNG L25CHERN L25TZSCH PREU27EN R27CKBAU F27HLTEN H27BSCHE SP27RBAR ZUL23SST 27LPREIS 27ZDEMIR 23NDERTE 23USSERN 27BEREIN 27BLICHE 27PPIGEN ABF23LLE BEM27HEN DI25ZESE F27CHSEN GM27NDER GER23TEN J27NGERE M25NNING N23MLICH RUM23NEN R23UMUNG SCHL23GE V25LKERN ANH25REN BI27CHEN EINL23DT GER27HRT G23NGIGE R27CKTEN W27RDIGT 27NGSTEN 23U27ERE AUSZ27GE BL23TTER D25RFERN D25RFLER GEF23HRT GEH23USE GER27CHT H27HNERN KL25TZER KOST27ME L25FFLER MA27STAB PORTR23T PR23MIEN SCH23DEL SPR27NGE ST25RUNG ANF23NGT DREI27IG F23LLIGE GEQU23LT GL23NZTE H25HERER H25HERES L23CHELT L23NGSTE SCH23TZE STIE27EN T23USCHT V25LLIGE WOR27BER W23HLBAR 27RMSTEN 27BERSEE 27BUNGEN ANL23SSE DRAU27EN H25CHSTE H25RMANN SCH23TZE SCH27TZE S23NGERS TR23GERN VORZ27GE WILLK27R ZSCH23PE AM27SANT BER27HMT DR23NGTE D27RFTIG F27HREND F27TTERN H25HEREM L23STIGE M27HELOS M27NDIGE SERI25SE VERF27GE VERP25NT VOR27BER ZUH25REN 27GYPTER 27LTEREN 27FTEREN ABL23UFE AFF23REN AUSSTO27 BETR23GE BR25RING B23NDERN D23CHERN ERG23NZT ERL25SEN F25RSTER F27NFTER GEPR27FT GR27BELN H27NFELD KL23NGEN K27HNERT NEUS2327 N23CHSTE PF27TZEN R27CKRUF STR23NDE ST25RCHE ST27RZEN TROPH23E TR23UMEN T23GLICH ZUBEH25R BEM27HTE BEW25LKT B27NDELN DEM27TIG F27NFMAL F27NFZIG GEB27HRT GEN23HRT GEW27RGT G27LTIGE HIN27BER KN27PFEN N23HERER N25TIGER PR23GTEN R27TTELN SCH25NEM ST25BERN UNF23HIG UNT23TIG 23RMSTEN 23USSERT ABG23NGE AUSMA27E BR23UCHE D23MPFER FU27NOTE F23CHERN F27TTERN GEB27SCH GETR23NK G27RB27Z G27STROW KAN23LEN K23UFERN M23NGELN M25CKERN M25LLERS PFR27NDE PR23GUNG RES27MEE RUM23NIN SCHWEI27 SCH23RFE SCH25NES ST23NDIG ST25HRER THAD23US TH27RING TSCH27SS VORR23TE WOR27BER ANF27HLT BEWU27TE BR27LLEN EMP25RTE ERN23HRT ERW23GEN FL27SSIG F27LLTEN GEF23RBT GEH23NGT GEL23HMT GESP27RT GEW27RZT GR2727EN H23RTERE K27MMERE MUTMA27T M27NDETE REGUL23R R23TSELN R23UMTEN SCH23BIG SCH27REN STR23UBT W23RMERE 23RMEREN ANFL27GE ANF23NGE ANL23UFE BETR27BT BL25CKEN BR23HLER BR27DERN B27CKERS B27NDNER B27RGERS DR23NGEN DR27CKER ERF27LLT FR25SCHE FU27WEGE GEF2327E GEW23HLT GR2727EN G27LLNER H23LFTEN H25LZERN H2525SCH KL23GERS KN25CHEL KR23NZKE KR27MMEL K23NGURU K25RPERN K25STERS L25FFELN M23RKLIN M25CHTEN M27LHEIM M27LLERS PFL27GEN PF23LZER P23RCHEN R27CKWEG SANIT23R SCHW23PO SCH25NAU ST23TTEN ST25CKLI ST27HLEN S23NGERN S25LDNER TR23UMER T27FTLER T27RCHEN V25LCHER W23CHTER Z27CHTER ABW23GEN ABW23RTS AUFH23LT AUSL25ST BEN27TZT BESA27EN BETR27BT D27STERE ERL25SEN ERTR23GT ERZ23HLE GEG25NNT GEH25RST GEK27HLT GEN27TZT GEW23HRE H23TTEST L23CHELN L25BLICH N23HERTE PREK23RE PRIM23RE SCHEI27E SCHW25RT SCH25PFT SCH27TZE ST27RMEN S23UMTEN S27CHTIG T25TETEN T27CHTIG T27RMTEN VERPA27T VER27BEN W27RDEST W27RDIGE W27TENDE 27LKRISE 27BERWEG 23RGERTE 27BERWOG ABG27SSE ABS23TZE ABZ27GEN ANF23LLE ANH25REN AUFZ27GE BR25MMEL BR25NNER BR27STEN BU27MANN B27CHLER C23CILIA D23MONEN ECKSTO27 ERG27SSE ERKL23RT FL27CKEN FL27SSEN FR27HERE F27LLUNG F27NFMAL F27RSTEN GEF27HLT GEM23UER GER23TES GEW25LBE GEW27RZE GL25TTER GR23BNER GR25SSTE GR27NROT H25WEDES H27SEYIN H27TTNER J27NGSTE J27RGENS KL27GERE KR23FTIG KR23NZEN KR25NERT KR25PCKE K25CKTER K25HLERS K25LLNER K25NIGEN K25NNTEN K27HBACH K27PPERS L23HMUNG L23UFERN L25CHGAU L27BECKS L27TTICH MA27KRUG MEI27NER MIGR23NE M23CHTEN M25LLNER M25RDERN NACHLA27 N27STTAL PAST25RS PFL27GER PR23SENT PR23ZISE PR27TZKE ROTGR27N R25HNERT R25NNING R25NTGEN R25TTGEN R27MMELE R27STUNG R27TTING SANIT23T SCHR25ER SCH23PER SCH23RLI SCH25MER SCH25NEN SCH25NER SCH27REN SCH27RZE SERI25SE SPIE27ER STR23TER ST23DTLE ST27CKES ST27MPER ST27RMEN S23BENER S27DLOHN S27DWEST TH25MMES TR23GERS TR25STAU T25NNIES T27CHERN T27RKIYE UEXK27LL UMF23NGE UMZ27GEN W23HLITZ W25RTERN ZUG23NGE ZUH25REN ZUZ27GEN ZW23NGEN Z27RICHS ABH23NGE ANF27HRT ANH25RTE AUFH25RT AUFL25ST AUSH23LT AUS27BTE BED27RFE BEF23NDE BEGN27GT BEGR27NT BEH27TEN BEK23MEN BEL23SST BER23UMT BETR27GT BET23UBT BR27CHIG BR27LLTE B23RTIGE B27NDELT DR25HNEN D23MLICH ENTLIE27 ERGIE27T ERH23NGT ERL23SST ERSP23HT ERZ27RNT F23HIGEN F23LSCHT F25RDERE F27HLBAR GEB23REN GED23MMT GED27NGT GEH23UFT GEH27LLT GEI27ELT GEKR25NT GEK25PFT GEK27SST GEM27NZT GENIE27E GER27HMT GESP27LT GET27RMT GL23TTET H23MMERN H23UFIGE H25FLICH KN27PFTE K25NNTET K27RZERE L23STERT L23UTETE L25SCHTE M23DCHEN M27HSAME NEBUL25S NERV25SE N23HEREM N27TZTEN PFL27CKT QU23LTEN R27STIGE R27TTELT SCHM23HT SCHN27RT SCHR23GE SCH23MEN SCH27RTE SPIE27IG SPR27HEN STR25MEN ST23NDEN ST23RKTE ST25HNEN TR23UMTE T23NZELN T23USCHE T25RICHT T27FTELN UMREI27T W27CHSEN W27RZIGE W27SSTEN W27TETEN ZUF27GEN ZW23NGEN ZW25LFTE Z25GERTE Z27CHTET Z27GIGEN 27CHTUNG 27KUMENE 27LMARKT 27BELSTE 27BRIGES 23RMLICH 23TZENDE 25RTLICH 27BERZOG 27BRIGES 17JHRIGE 2018ALEX 95773780 95775272 ABH25REN ABSCHU27 ACIKG25Z ADERLA27 ALL27REN ANH23NGE ANW27RFE ARGAN25L AUM27HLE AUSFLU27 AUTOT27R BAUL23RM BEL23GEN BER27HMT BETR23GT BEW23HRT BE27LICH BIOH25FE BL27THEN BR23GGER BR23NDEN BR23TELN BR25SSEL BR27CHAU BR27GGEN BR27LLEN BR27NING BR27NNER B23CKERS B23HLAMM B23RTSCH B23UERLE B25GERLS B25HMLER B25RNSEN B25SMANN B25TTGER B27CHNER B27HRING B27SCHER B27TTELN B27TTNER CHOR23LE CR27WELL C27PPERS DOMR25SE DOMS27HL DR23UEND DR27CKEN DU27MANN D23BRITZ D23MMUNG D23SCHLE D25BLING D25BLINS D25NEKES D25RFFEL D25SCHEN D27RWI27 D27THORN D27TTING EKSTR25M ELIT23RE ERDSTO27 ERIT23ER ERL25SER ERL25SES ERR25TEN FLEI27IG FL2527ER FL27ELER FL27GELS FREIFU27 FR23NKEL FU27EDER FU27RAUM FU27STEG FU27VOLK FU27WEGS F25RDERN F25RTSCH F27HREND F27HRTEN F27NFERL F27NFTEN F27NFZIG F27RCHTE F27RHUNG F27RMANN GAI27LER GEBL23SE GEB23REN GEF23LLE GEF23LLT GEF27GES GEF27HRT GEH23NGE GEH25LZE GEH25RTE GEI27ELN GEL23UFE GEL27BDE GEL27STE GENIE27T GEN27SSE GEPR23GT GER27CHE GER27STE GES23NGE GETR27BT GEW27RGE GEZ23HLT GRO27MUT GRO27TAT GR23BERN GR23TSCH GR25FLIN GR2527ER GR2527TE GR27NAUE GR27NTEE GSCHPA27 G25BBELS G25RINGS G25RLITZ G25TTERN G25TTING G27LDNER G27RGENS G27RTELN G27SSING G27TLICH HA27FURT HECKT27R HYYPI23S H23KCHEN H23NDELS H23RTERE H23UFUNG H23UPTER H23USLER H2327LER H25FLICH H25HEREN H25LLEIN H25PPNER H25RBACH H25RBUCH H25RNERN H25SBACH H25SCHEN H25SCHLE H25VENER H27BNERS J23HRIGE J23NICKE J23NNERS J27CHERT KL23GERN KL25STER KL27TZER KN23STEN KN25DLER KN25PFLE KN27PPEL KOKOS25L KO27MEHL KR23MPFE KR25SCHE KR27CKEN KR27PPEL K23BISCH K23RCHER K23SEBAR K23SEREI K23STLIS K25CHELN K25LMELS K25NNING K25PFIGE K25RNERN K27CHLER K27HFU27 K27MMERT K27NSTEN K27RZELN K27RZELS K27RZERE K27STRIN L23MMERN L23NGERE L23STERN L25BAUER L25LLING L25PPING L25RRACH L25SCHEN L25SCHER L27BBENS L27CKNER L27DECKE L27FTUNG L27SCHER MA27BAND MA27GABE MA27MANN MEI27ELN MEI27ELS M27GLICH M23RSCHE M23USERS M25HRING M25RELER M25SSNER M27GLITZ M27LLNER M27SSTEN M2727TEN NOTL27GE N23CHTEN N23GELIN N23HRICH N23SCHEN N23SLUND PARF27MS PER27CKE PL23NITZ POPUL23R PREK23RE P23PSTEN P25SCHEL P25STLER P25TTMES REGUL23R ROTGR27N RO27BECK RO27DORF RO27KOPF RO27MANN R23DCHEN R23NDERN R23UBERN R23UCHER R25DIGER R25HRTAL R25SENER R25SRATH R25SSLER R25STUNG R25TTELE R27CKERT R27CKRAT R27HRUNG R27LAUER R27MLANG R27SCHEN R27STZUG SCHIE27T SCHL23GT SCHM23HS SCHR25CK SCH23FLE SCH23MEN SCH23PPI SCH25FFE SCH25PFT SCH27BEN SCH27LBE SCH27LKE SCH27TTE SCH27TTS SEE27LEN SPH23REN SPR23CHE SPR27HEN SP23HERN SP23TERE SP27LUNG STAVSJ25 STR23NGE STR25BER STR25MEN STR25VER ST23DTER ST23LLEN ST23RKER ST25BERN ST25CKEL ST2527EN ST2527ER ST27TZEN S27DWEST S23VEHOF S25LKTAL S25RRIES S27DRING S27DTEIL S27SELER TAKTMA27 TH25NNES TH27RKOW TR27BSAL TR27MMER TR27MPFE T23NZERN T23USCHT T25DLICH T27CKING T27FTELN T27RKSOY UMH23NGE UML23UFE UNF23HIG URS27NDE VERDRU27 VERH25RE VERSMA27 VER23PPL VER25DEN WEI27ACH WE27LING W23HLERS W23HRING W23LCHLI W23SSERT W27RMERN W27RMTAL W27TENDE ZUK23UFE ZW23NGER ZW25LFTE Z27RCHER Z23HLUNG Z25LLMER Z25LLNER Z27LPICH Z27NFTIG ABF23LLT ABGEH25R ABG23BEN ABH23NGT ABH25REN ABL23SST ABL25SEN ABL25STE ABR27CKT ABW23LZT AD23QUAT ANFA27TE ANF27GEN ANH23UFT ANL23UFT ANMA27EN AUFH25RE AUSS23HE BEF27LLT BEGR23BT BEG23NNE BEG25NNE BEH23BIG BEH27TET BEI27END BEL27GEN BES2327E BETR27GE BET25RTE BE23UGEN BR23CHTE B25SESTE B27GELTE B27RSTEN B2727TEN D23MMERN D23MPFEN D27MPELN D27MPELT D27NNTEN D27NSTET D27PIERT D27RSTET EINF27GE EINLIE27 EIN27BEN ERF27LLE ERGR27NT ERG23NZE ERH25RTE ERKL23RE ERL25STE ERM27DET ERN23HRE ERT25NEN ERT25NTE ERW23HNE ERW27RGT ER25FFNE FL25SSEN FU27ENDE FU27WARM F23LLTEN F23LSCHE F27HRBAR F27NFTER F27NFTES F27RWAHR GEB27HRE GEB27SST GEH27PFT GEK25RTE GEL25STE GEN27GTE GES27HNT GEW23NNE GEW27HLT GE27BTEN GL27CKEN GL27HTEN GRAZI25S GRO27ZOG GR25HLEN GR2527EN GR27BELT GR2727TE G23HNEND G23NGELN G27TLICH HER27BER HINH23LT HINH25RT HINK23ME H23MMERE H23MMERT H23NDLER H23NGTEN H23NGTSO H23UFTEN H25RENDE H25RIGEN H27LLTEN H27TETEN J23TETEN KIIWII79 KL23RTEN KL27GSTE KONTR23R KR23NKER K27HLERE K27HLTEN K27NDBAR LOSLIE27 L23DIERT L23NDERN L23PPERT L23STERN L25CHRIG L27MMELT MA27VOLL M25GLCIH N23CHSTS PFL27GEN POR25SES PR23GEND PR27GELN QU23KTEN QU23LEND R23TSELT R27HREND R27HRTEN R27LPSET R27SSELT SCHL27GE SCHW25RE SCHW27LE SCH23LEN SCH23MTE SCH23NDE SCH23RFT SCH27LER SPRIE27T SPR25DER SPR27HTE SP27LTEN SP27RTEN STR25MTE ST25BERE ST25BERT ST27RMTE S23CHSCH S23USELN S23USELT TRAT1957 TR25STEN TSCH27SS T23TLICH T27FTELT UMS23UMT VERH25RT VERL25RE VERM25GE VERT23UT VER23TZT VER25DET VULG23RE W23HNTEN W23SSERN W23SSERT ZERS23GT ZUF23LIG ZUH25RTE ZUL23UFT ZUL2327T Z27CHTEN Z27CKTEN Z27NDETE Z27NFTIG Z27NGELN Z27RCHER 27LTERER 27UGLEIN 27USSERE 27U27ERN 27FFNETE 27HRCHEN 27KOTEST 27LHAFEN 27LOFENS 27LSTAND 27LTREND 27RTCHEN 27SCHWEG 27ZT27RK 27BERBAU 27BERZUG 27BLICHE 23NDERND 23RMERER 23USSERE 25FTEREN 27BELSTE 27BRIGEM 27PPIGST
EOF;

  return explode(" ", $arc);
}
